{
  "request_id": "20251120_195020_6209e991",
  "timestamp": "2025-11-20T19:50:20.629674",
  "endpoint": "http://qdoc.ecmxpert.com:44444/v1/chat/completions",
  "model": "qwen3-instruct-2507",
  "payload": {
    "model": "qwen3-instruct-2507",
    "messages": [
      {
        "role": "system",
        "content": "You are an EXPERT at extracting billing lines from Thai medical receipts. Return ONLY simple list with [L1]/[L2]/[L3] markers."
      },
      {
        "role": "system",
        "content": "CRITICAL EXTRACTION RULES:\n1. Top-level fields: hospital_name, hn, an, admission_date, patient_name, vn_en, amount_total, discount_total, net_amount_total\n2. Billing item fields: billing_code | billing_desc | item_level | amount | discount | net_amount | grouporder_items | item_level\n3. Order item fields: billing_code | billing_desc | amount | discount | net_amount (ONLY medicine/drug items)\n4. billing_code MUST contain digits (e.g., '1.2.1', '1.6.1(1)') - use null if missing or invalid\n5. Order items: codes starting with '1.1.1', '1.1.12', '1.1.14' OR medicine keywords (ยา, tablet, injection, mg, ml)\n6. Billing items: all other items (services, fees, tests)\n7. EXCLUDE aggregate lines: 'รวม', 'ยอดรวม', 'สุทธิ', 'total', 'summary'\n8. Set item_level: 1 (L1), 2 (L2), or 3 (L3) based on hierarchy\n9. All decimal values as strings (e.g., '15.00', '2200.00')\nReturn ONLY [K]/[L1]/[L2]/[L3] lines. No JSON. No explanations."
      },
      {
        "role": "user",
        "content": "Extract billing lines and header fields from the OCR text and return ONLY a compact simple list.\n\nHeader format: \n[K] key | value\n\nBilling format: \n[L1] code | desc | amount | discount | net\n[L2] code | desc | amount | discount | net\n[L3] item_desc | quantity | amount | discount | net\n\nHeader Keys: hospital_name, hn, an, admission_date, patient_name, vn_en, amount_total, discount_total, net_amount_total\n\nRules:\n- Exclude totals: รวม, ยอดรวม, สุทธิ, total, summary (billing section)\n- Keep decimals as strings (e.g., 1410.00)\n- Use actual billing codes with digits for [L1]/[L2] (e.g., 1.1.1, 1.1.1(2))\n- Medicine/drug details go as [L3] under their [L2] parent context\n- If a header value is not found, use '-'\n\nOCR Text:\nโรงพยาบาลกรุงเทพ Print Date : 24 ส.ค. 2021 จันทบุรี Print Time : 17:27:10 ใบแจ้งรายละเอียดการรักษาพยาบาล Patient Name : นาย วรากร ผอบแก้ว HN : 04-04-021008 EN : 104-21-010742 Admission Date : 23/08/2021 Room : Ward 5B/2515 ค่ารักษาพยาบาลตั้งแต่วันที่ : 23 ส.ค. 2021 - 24 ส.ค. 2021 รายการคารักษาพยาบาล ปริมาณ ค่ารักษา สวนลด คารักษาหลังหักส่วนลด 1.1.1 คายาและสารอาหารทางเสนเลือด 1.1.1(18) คานำเกลือ 2,146.00 214.60 1.931.40 D-5-S/2 (no set) SOFT BAGS (1000 mL) 2 Bag 1,410.00 141.00 1,269.00 H.S.S (100 ml) Injection 2 Bag 736.00 73.60 662.40 1.1.1 คายา 6,716.00 671.60 6,044.40 AIR-X Tablet * (120 mg) * - สีทอง- 4 Tablet 84.00 8.40 75.60 Buscopan Tablet (10 mg) 4 Tablet 100.00 10.00 90.00 Electrolyte Powder (ORS) Orange 5 Pack 185.00 18.50 166.50 GASmotin TABLET (5 mg)-GASmotin- 4 Tablet 212.00 21.20 190.80 Hidrasec (100 mg) Cap - เม็ด 4 Capsule 352.00 35.20 316.80 H ybutyl inj. - Buscopan ฉีด - 1 Amp 857.00 85.70 771.30 KetoLAC Inj (30 mg) 1 Amp 788.00 78.80 709.20 Meicelin Injection (1 gm) 4 Vial 4,120.00 412.00 3,708.00 Ropermide Cap (2mg)- Imodium - 1 Capsule 18.00 1.80 16.20 1.1.1(2) ยากลับบาน (Home Medication) 849.00 84.90 764.10 AIR-X Tablet * (120 mg) * - สีทอง- 5 Tablet 50.00 5.00 45.00 Buscopan Tablet (10 mg) 4 Tablet 48.00 4.80 43.20 Ciprobay Tab * * 500 mg * * -O- 4 Tablet 464.00 46.40 417.60 Electrolyte Powder (ORS) Orange 5 Pack 95.00 9.50 85.50 GASmotin TABLET (5 mg)-GASmotin- 4 Tablet 152.00 15.20 136.80 PARAMED * * 500 mg * * Tablet -- เม็ด -- 10 Tablet 40.00 4.00 36.00 1.1.2 คาเวชภัณฑ์ 1.1.2(1) เวชภัณฑ์ 1 วัสดุสิ้นเปลืองทางการแพทย์ 1,906.00 0.00 1,906.00 Cotton Sterile 0.35 Gm (3 Pcs/) 1 6.00 0.00 6.00 Curos Stopper Cap (CSAI-270) 1 39.00 0.00 39.00 Extention Set With T 1 242.00 0.00 242.00 I.V. Catheter (Jelco) #24 (1X50) 1 274.00 0.00 274.00 IV SET AV (TYPE-500) 2 222.00 0.00 222.00 Iv Set Model Infusomat Space Line With Injection Port 1 429.00 0.00 429.00 PIV KIT With Tegaderm (setผู้ ใหญ่ ) 1 153.00 0.00 153.00 Syringr 10 MI (Disp.) 6 168.00 0,00 168.00 Thermometer Probe Cover Sheath (Digital) 84.00 0.00 34.00 Three Ways W/O Lock 1 1 250.00 0.00 250.00 Waterproof Bandage 1 39.00 0.00 39.00 1.1.4 คาตรวจวินิจฉัยทางเทคนิคการแพทย์และพยาธิวิทยา 1.1.4 คาตรวจวินิจฉัยทางเทคนิคการแพทย์ 3,100.00 310.00 2,790.00 ALT (Alanine Transaminase)(SGPT) 1 300.00 30.00 270.00 Complete Blood Count. 1 1 300.00 30.00 270.00 Glucose (Random) 1 210.00 21.00 189.00 Potassium 1 300.00 30.00 270.00 Somum 1 1 300.00 30.00 270.00 Stool Culture (OPD) 1 1,090.00 109.00 981.00 Stool Examination 1 300.00 30.00 270.00 FM-CAS-25(01) /2"
      }
    ],
    "seed": null,
    "stop": null,
    "temperature": 0.7,
    "top_p": 0.8,
    "max_tokens": 4000,
    "frequency_penalty": 0,
    "presence_penalty": 0
  },
  "prompt": "Extract billing lines and header fields from the OCR text and return ONLY a compact simple list.\n\nHeader format: \n[K] key | value\n\nBilling format: \n[L1] code | desc | amount | discount | net\n[L2] code | desc | amount | discount | net\n[L3] item_desc | quantity | amount | discount | net\n\nHeader Keys: hospital_name, hn, an, admission_date, patient_name, vn_en, amount_total, discount_total, net_amount_total\n\nRules:\n- Exclude totals: รวม, ยอดรวม, สุทธิ, total, summary (billing section)\n- Keep decimals as strings (e.g., 1410.00)\n- Use actual billing codes with digits for [L1]/[L2] (e.g., 1.1.1, 1.1.1(2))\n- Medicine/drug details go as [L3] under their [L2] parent context\n- If a header value is not found, use '-'\n\nOCR Text:\nโรงพยาบาลกรุงเทพ Print Date : 24 ส.ค. 2021 จันทบุรี Print Time : 17:27:10 ใบแจ้งรายละเอียดการรักษาพยาบาล Patient Name : นาย วรากร ผอบแก้ว HN : 04-04-021008 EN : 104-21-010742 Admission Date : 23/08/2021 Room : Ward 5B/2515 ค่ารักษาพยาบาลตั้งแต่วันที่ : 23 ส.ค. 2021 - 24 ส.ค. 2021 รายการคารักษาพยาบาล ปริมาณ ค่ารักษา สวนลด คารักษาหลังหักส่วนลด 1.1.1 คายาและสารอาหารทางเสนเลือด 1.1.1(18) คานำเกลือ 2,146.00 214.60 1.931.40 D-5-S/2 (no set) SOFT BAGS (1000 mL) 2 Bag 1,410.00 141.00 1,269.00 H.S.S (100 ml) Injection 2 Bag 736.00 73.60 662.40 1.1.1 คายา 6,716.00 671.60 6,044.40 AIR-X Tablet * (120 mg) * - สีทอง- 4 Tablet 84.00 8.40 75.60 Buscopan Tablet (10 mg) 4 Tablet 100.00 10.00 90.00 Electrolyte Powder (ORS) Orange 5 Pack 185.00 18.50 166.50 GASmotin TABLET (5 mg)-GASmotin- 4 Tablet 212.00 21.20 190.80 Hidrasec (100 mg) Cap - เม็ด 4 Capsule 352.00 35.20 316.80 H ybutyl inj. - Buscopan ฉีด - 1 Amp 857.00 85.70 771.30 KetoLAC Inj (30 mg) 1 Amp 788.00 78.80 709.20 Meicelin Injection (1 gm) 4 Vial 4,120.00 412.00 3,708.00 Ropermide Cap (2mg)- Imodium - 1 Capsule 18.00 1.80 16.20 1.1.1(2) ยากลับบาน (Home Medication) 849.00 84.90 764.10 AIR-X Tablet * (120 mg) * - สีทอง- 5 Tablet 50.00 5.00 45.00 Buscopan Tablet (10 mg) 4 Tablet 48.00 4.80 43.20 Ciprobay Tab * * 500 mg * * -O- 4 Tablet 464.00 46.40 417.60 Electrolyte Powder (ORS) Orange 5 Pack 95.00 9.50 85.50 GASmotin TABLET (5 mg)-GASmotin- 4 Tablet 152.00 15.20 136.80 PARAMED * * 500 mg * * Tablet -- เม็ด -- 10 Tablet 40.00 4.00 36.00 1.1.2 คาเวชภัณฑ์ 1.1.2(1) เวชภัณฑ์ 1 วัสดุสิ้นเปลืองทางการแพทย์ 1,906.00 0.00 1,906.00 Cotton Sterile 0.35 Gm (3 Pcs/) 1 6.00 0.00 6.00 Curos Stopper Cap (CSAI-270) 1 39.00 0.00 39.00 Extention Set With T 1 242.00 0.00 242.00 I.V. Catheter (Jelco) #24 (1X50) 1 274.00 0.00 274.00 IV SET AV (TYPE-500) 2 222.00 0.00 222.00 Iv Set Model Infusomat Space Line With Injection Port 1 429.00 0.00 429.00 PIV KIT With Tegaderm (setผู้ ใหญ่ ) 1 153.00 0.00 153.00 Syringr 10 MI (Disp.) 6 168.00 0,00 168.00 Thermometer Probe Cover Sheath (Digital) 84.00 0.00 34.00 Three Ways W/O Lock 1 1 250.00 0.00 250.00 Waterproof Bandage 1 39.00 0.00 39.00 1.1.4 คาตรวจวินิจฉัยทางเทคนิคการแพทย์และพยาธิวิทยา 1.1.4 คาตรวจวินิจฉัยทางเทคนิคการแพทย์ 3,100.00 310.00 2,790.00 ALT (Alanine Transaminase)(SGPT) 1 300.00 30.00 270.00 Complete Blood Count. 1 1 300.00 30.00 270.00 Glucose (Random) 1 210.00 21.00 189.00 Potassium 1 300.00 30.00 270.00 Somum 1 1 300.00 30.00 270.00 Stool Culture (OPD) 1 1,090.00 109.00 981.00 Stool Examination 1 300.00 30.00 270.00 FM-CAS-25(01) /2"
}