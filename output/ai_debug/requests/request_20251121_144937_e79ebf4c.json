{
  "request_id": "20251121_144937_e79ebf4c",
  "timestamp": "2025-11-21T14:49:37.417065",
  "endpoint": "http://qdoc.ecmxpert.com:44444/v1/chat/completions",
  "model": "qwen3-instruct-2507",
  "payload": {
    "model": "qwen3-instruct-2507",
    "messages": [
      {
        "role": "system",
        "content": "You are an EXPERT at extracting billing lines from Thai medical receipts. Return ONLY simple list with [L1]/[L2]/[L3] markers."
      },
      {
        "role": "system",
        "content": "CRITICAL EXTRACTION RULES:\n1. Top-level fields: hospital_name, hn, an, invoice_no, invoice_date, company_name, discount, admission_date, discharge_date, total_admit_date, patient_name, age, doctor_name, doctor_department, company_code, service_code, branch_code, ref1, ref2, vn_en, total_invoice_amount, cashier_invoice_date, cashier_name, bed_room, ward\n2. Billing item fields: billing_code | billing_desc | item_level | item_amont | amount | discount | net_amount | grouporder_items | item_level\n3. Order item fields: billing_code | billing_desc | amount | discount | net_amount (ONLY medicine/drug items)\n4. billing_code MUST contain digits (e.g., '1.2.1', '1.6.1(1)') - use null if missing or invalid\n5. Order items: codes starting with '1.1.1', '1.1.12', '1.1.14' OR medicine keywords (ยา, tablet, injection, mg, ml)\n6. Billing items: all other items (services, fees, tests)\n7. EXCLUDE aggregate lines: 'รวม', 'ยอดรวม', 'สุทธิ', 'total', 'summary'\n8. Set item_level: 1 (L1), 2 (L2), or 3 (L3) based on hierarchy\n9. All decimal values as strings (e.g., '15.00', '2200.00')\nReturn ONLY [K]/[L1]/[L2]/[L3] lines. No JSON. No explanations."
      },
      {
        "role": "user",
        "content": "Extract billing lines and header fields from the OCR text and return ONLY a compact simple list.\n\nHeader format: \n[K] key | value\n\nBilling format: \n[L1] code | desc | amount | discount | net\n[L2] code | desc | amount | discount | net\n[L3] item_desc | quantity | amount | discount | net\n\nHeader Keys: hospital_name, hn, an, invoice_no, invoice_date, company_name, discount, admission_date, discharge_date, total_admit_date, patient_name, age, doctor_name, doctor_department, company_code, service_code, branch_code, ref1, ref2, vn_en, total_invoice_amount, cashier_invoice_date, cashier_name, bed_room, ward\n\nRules:\n- Exclude totals: รวม, ยอดรวม, สุทธิ, total, summary (billing section)\n- Keep decimals as strings (e.g., 1410.00)\n- Use actual billing codes with digits for [L1]/[L2] (e.g., 1.1.1, 1.1.1(2))\n- Medicine/drug details go as [L3] under their [L2] parent context\n- If a header value is not found, use '-'\n\nOCR Text:\n============================================================\r\nหน้าที่ 1\r\n============================================================\r\nเรงพยาบาสกรุงเทพ BANGKOK HOSPITAL ใบแจ้งค่ารักษาพยาบาลผู้ป่วยใน Page I of I 6 Print Date 20/12/2024 เชียงราย · CHIANG RAI Print Time . 11:26 คารักษาพยาบาล เด็กชายพสธร ปทุมณี FAY AXA HN. 55-22-002296 EN. 155-24-007324 Ward : Ward 5 Room : A503 แจงค่ารักษาพยาบาลตั้งแต : 17/12/2024 -. 20/12/2024 วันที่เข้ารับการรักษา : 17/12/2024 นอน สน. 3 1ุน Item List Total Amount Discount Total Net คายาและสารอาหารทางเสนเลือด 1.1.1 ค่าน้ำเกลือ 1.1.1(1) 2,134.00 213.40 1,920.60 ค่ายา 1.1.1(1) 8,016.80 801.68 7,215.12 ค่ายาผู้ป่วยในกลับบ้าน 767.00 76.70 690.30 ค่าออกซิเจน 1.1.1(1) 1,200.00 120.00 1,080.00 คาเวชภัณฑ์ 1.1.2 เวชภัณฑ์ 1 วัสดุสิ้นเปลืองทางการแพทย์ 1.1.2(1) 1,692.00 169.20 1,522.80 คาตรวจวินิจฉัยทางเทคนิคการแพทย์และพยาธิวิทยา 1.1.4 ค่าตรวจวินิจฉัยทางเทคนิคการแพทย์ 1.1.4 2,994.00 299.40 2,694.60 คาบริการพยาบาลของผู้ประกอบวิชาชีพการพยาบาลหรือการผดุงครรภ์ 1.1.12 4. ค่าบริการการพยาบาลของผู้ประกอบวิชาชีพการพยาบาลและการผดุงครรภ์ (A1000X3 3,000.00 0.00 3,000.00 1.1.12 คาบริการเหมาจายค่ารักษาพยาบาล 1.1.14 ค่าบริการทางการแพทย์อื่น ๆ 1.1.14(2) @900x3 2,700.00 270.00 2,430.00 ค่าตรวจรักษาทั่วไปของผู้ประกอบวิชาชีพ 1.2.1 ค่าตรวจรักษา 1.2.1 3,600.00 0.00 3,600.00 ค่าห้องหรือค่าเตียงผู้ป่วยใน ประเภทต่าง ๆ 2.1 ค่าหอง ค่าเตียงและอุปกรณ์มาตรฐานประจำห้องผู้ป่วยในประเภทต่างๆ A1600x3 4,800.00 480.00 4,320.00 2.1 ค่าอาหารผู้ป่วย 2.3 อาหารผู้ป่วยในปกติ 2.3.1 1,440.00 0.00 1,440.00 32,343.80 2,430.38 29,913.42 รวมค่ารักษาพยาบาล สองหมื่นเก้าพันเก้าร้อยสิบสามบาทสี่สิบสองสตางค์ เจาหนาทีการเงิน กันติมา สุวินยชัย โรงพยาบาลกรุงเทพเชียงราย BANGKOK HOSPITAL CHIANGRAI ยอดค่ารักษาพยาบาลนี้เป็นยอดรวมสำหรับช่วงวันที่ที่ระบุไว้ ค่ารักษาพยาบาลสุทธิและความคุ้มครองตามกรมธรรม์ (ถ้ามี) จะแจ้งให้ท่านรับทราบในวันเสร็จสิ้นการรักษา กรณาติดต่อชำระเงินที่แผนกอารเงิบผ้ป่วยใน โทร /052)051-800 แปคล์ (053"
      }
    ],
    "seed": null,
    "stop": null,
    "temperature": 0.1,
    "top_p": 0.9,
    "max_tokens": 10000,
    "frequency_penalty": 0,
    "presence_penalty": 0
  },
  "prompt": "Extract billing lines and header fields from the OCR text and return ONLY a compact simple list.\n\nHeader format: \n[K] key | value\n\nBilling format: \n[L1] code | desc | amount | discount | net\n[L2] code | desc | amount | discount | net\n[L3] item_desc | quantity | amount | discount | net\n\nHeader Keys: hospital_name, hn, an, invoice_no, invoice_date, company_name, discount, admission_date, discharge_date, total_admit_date, patient_name, age, doctor_name, doctor_department, company_code, service_code, branch_code, ref1, ref2, vn_en, total_invoice_amount, cashier_invoice_date, cashier_name, bed_room, ward\n\nRules:\n- Exclude totals: รวม, ยอดรวม, สุทธิ, total, summary (billing section)\n- Keep decimals as strings (e.g., 1410.00)\n- Use actual billing codes with digits for [L1]/[L2] (e.g., 1.1.1, 1.1.1(2))\n- Medicine/drug details go as [L3] under their [L2] parent context\n- If a header value is not found, use '-'\n\nOCR Text:\n============================================================\r\nหน้าที่ 1\r\n============================================================\r\nเรงพยาบาสกรุงเทพ BANGKOK HOSPITAL ใบแจ้งค่ารักษาพยาบาลผู้ป่วยใน Page I of I 6 Print Date 20/12/2024 เชียงราย · CHIANG RAI Print Time . 11:26 คารักษาพยาบาล เด็กชายพสธร ปทุมณี FAY AXA HN. 55-22-002296 EN. 155-24-007324 Ward : Ward 5 Room : A503 แจงค่ารักษาพยาบาลตั้งแต : 17/12/2024 -. 20/12/2024 วันที่เข้ารับการรักษา : 17/12/2024 นอน สน. 3 1ุน Item List Total Amount Discount Total Net คายาและสารอาหารทางเสนเลือด 1.1.1 ค่าน้ำเกลือ 1.1.1(1) 2,134.00 213.40 1,920.60 ค่ายา 1.1.1(1) 8,016.80 801.68 7,215.12 ค่ายาผู้ป่วยในกลับบ้าน 767.00 76.70 690.30 ค่าออกซิเจน 1.1.1(1) 1,200.00 120.00 1,080.00 คาเวชภัณฑ์ 1.1.2 เวชภัณฑ์ 1 วัสดุสิ้นเปลืองทางการแพทย์ 1.1.2(1) 1,692.00 169.20 1,522.80 คาตรวจวินิจฉัยทางเทคนิคการแพทย์และพยาธิวิทยา 1.1.4 ค่าตรวจวินิจฉัยทางเทคนิคการแพทย์ 1.1.4 2,994.00 299.40 2,694.60 คาบริการพยาบาลของผู้ประกอบวิชาชีพการพยาบาลหรือการผดุงครรภ์ 1.1.12 4. ค่าบริการการพยาบาลของผู้ประกอบวิชาชีพการพยาบาลและการผดุงครรภ์ (A1000X3 3,000.00 0.00 3,000.00 1.1.12 คาบริการเหมาจายค่ารักษาพยาบาล 1.1.14 ค่าบริการทางการแพทย์อื่น ๆ 1.1.14(2) @900x3 2,700.00 270.00 2,430.00 ค่าตรวจรักษาทั่วไปของผู้ประกอบวิชาชีพ 1.2.1 ค่าตรวจรักษา 1.2.1 3,600.00 0.00 3,600.00 ค่าห้องหรือค่าเตียงผู้ป่วยใน ประเภทต่าง ๆ 2.1 ค่าหอง ค่าเตียงและอุปกรณ์มาตรฐานประจำห้องผู้ป่วยในประเภทต่างๆ A1600x3 4,800.00 480.00 4,320.00 2.1 ค่าอาหารผู้ป่วย 2.3 อาหารผู้ป่วยในปกติ 2.3.1 1,440.00 0.00 1,440.00 32,343.80 2,430.38 29,913.42 รวมค่ารักษาพยาบาล สองหมื่นเก้าพันเก้าร้อยสิบสามบาทสี่สิบสองสตางค์ เจาหนาทีการเงิน กันติมา สุวินยชัย โรงพยาบาลกรุงเทพเชียงราย BANGKOK HOSPITAL CHIANGRAI ยอดค่ารักษาพยาบาลนี้เป็นยอดรวมสำหรับช่วงวันที่ที่ระบุไว้ ค่ารักษาพยาบาลสุทธิและความคุ้มครองตามกรมธรรม์ (ถ้ามี) จะแจ้งให้ท่านรับทราบในวันเสร็จสิ้นการรักษา กรณาติดต่อชำระเงินที่แผนกอารเงิบผ้ป่วยใน โทร /052)051-800 แปคล์ (053"
}