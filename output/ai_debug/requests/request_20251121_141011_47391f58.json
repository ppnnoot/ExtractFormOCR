{
  "request_id": "20251121_141011_47391f58",
  "timestamp": "2025-11-21T14:10:11.943512",
  "endpoint": "http://qdoc.ecmxpert.com:44444/v1/chat/completions",
  "model": "qwen3-instruct-2507",
  "payload": {
    "model": "qwen3-instruct-2507",
    "messages": [
      {
        "role": "system",
        "content": "You are an EXPERT at extracting billing lines from Thai medical receipts. Return ONLY simple list with [L1]/[L2]/[L3] markers."
      },
      {
        "role": "system",
        "content": "CRITICAL EXTRACTION RULES:\n1. Top-level fields: hospital_name, hn, vn, receipt_date, receipt_no, patient_name, age, treatment_date, policyno, total_amount_in_writing, an, cashier_name, visit_date, patient_signature, cashier_signature\n2. Billing item fields: billing_code | billing_desc | item_level | amount | discount | net_amount | grouporder_items | item_level\n3. Order item fields: billing_code | billing_desc | amount | discount | net_amount (ONLY medicine/drug items)\n4. billing_code MUST contain digits (e.g., '1.2.1', '1.6.1(1)') - use null if missing or invalid\n5. Order items: codes starting with '1.1.1', '1.1.12', '1.1.14' OR medicine keywords (ยา, tablet, injection, mg, ml)\n6. Billing items: all other items (services, fees, tests)\n7. EXCLUDE aggregate lines: 'รวม', 'ยอดรวม', 'สุทธิ', 'total', 'summary'\n8. Set item_level: 1 (L1), 2 (L2), or 3 (L3) based on hierarchy\n9. All decimal values as strings (e.g., '15.00', '2200.00')\nReturn ONLY [K]/[L1]/[L2]/[L3] lines. No JSON. No explanations."
      },
      {
        "role": "user",
        "content": "Extract billing lines and header fields from the OCR text and return ONLY a compact simple list.\n\nHeader format: \n[K] key | value\n\nBilling format: \n[L1] code | desc | amount | discount | net\n[L2] code | desc | amount | discount | net\n[L3] item_desc | quantity | amount | discount | net\n\nHeader Keys: hospital_name, hn, vn, receipt_date, receipt_no, patient_name, age, treatment_date, policyno, total_amount_in_writing, an, cashier_name, visit_date, patient_signature, cashier_signature\n\nRules:\n- Exclude totals: รวม, ยอดรวม, สุทธิ, total, summary (billing section)\n- Keep decimals as strings (e.g., 1410.00)\n- Use actual billing codes with digits for [L1]/[L2] (e.g., 1.1.1, 1.1.1(2))\n- Medicine/drug details go as [L3] under their [L2] parent context\n- If a header value is not found, use '-'\n\nOCR Text:\n============================================================\r\nหน้าที่ 1\r\n============================================================\r\nบิลเงินสด คลินิกแพทย์ศิรินนท์ CASH SALES - 58/8-9 ถ.ท่าช้าง อ.เมือง จ.อุทัยธ เล่มที่ HBOOK NO. โทร. 056-571257 เลขที่ 004 BILL NO. วันที่ 5 มค 2565 DATE : นามลูกค้า ณชมน มเผา CUSTÔMER: เลขประจำตัวประชาชน/ ที่อยู่ เลขประจำตัวผู้เสียภาษีอากร ADOŘESS: จำนวน QUANTITY รายการ หน่วยละ จำนวนเงิน DESCRPTION UNIT PRCE AMOUNT ค่ายา 150 กับฉยับ 1 รวมเงิน TOTAL 150 ผู้รับเงิน ภยักร RECEIVED BY : ขอรับเงินด้วยความขอบคุณ Elaphant Brand"
      }
    ],
    "seed": null,
    "stop": null,
    "temperature": 0.1,
    "top_p": 0.9,
    "max_tokens": 10000,
    "frequency_penalty": 0,
    "presence_penalty": 0
  },
  "prompt": "Extract billing lines and header fields from the OCR text and return ONLY a compact simple list.\n\nHeader format: \n[K] key | value\n\nBilling format: \n[L1] code | desc | amount | discount | net\n[L2] code | desc | amount | discount | net\n[L3] item_desc | quantity | amount | discount | net\n\nHeader Keys: hospital_name, hn, vn, receipt_date, receipt_no, patient_name, age, treatment_date, policyno, total_amount_in_writing, an, cashier_name, visit_date, patient_signature, cashier_signature\n\nRules:\n- Exclude totals: รวม, ยอดรวม, สุทธิ, total, summary (billing section)\n- Keep decimals as strings (e.g., 1410.00)\n- Use actual billing codes with digits for [L1]/[L2] (e.g., 1.1.1, 1.1.1(2))\n- Medicine/drug details go as [L3] under their [L2] parent context\n- If a header value is not found, use '-'\n\nOCR Text:\n============================================================\r\nหน้าที่ 1\r\n============================================================\r\nบิลเงินสด คลินิกแพทย์ศิรินนท์ CASH SALES - 58/8-9 ถ.ท่าช้าง อ.เมือง จ.อุทัยธ เล่มที่ HBOOK NO. โทร. 056-571257 เลขที่ 004 BILL NO. วันที่ 5 มค 2565 DATE : นามลูกค้า ณชมน มเผา CUSTÔMER: เลขประจำตัวประชาชน/ ที่อยู่ เลขประจำตัวผู้เสียภาษีอากร ADOŘESS: จำนวน QUANTITY รายการ หน่วยละ จำนวนเงิน DESCRPTION UNIT PRCE AMOUNT ค่ายา 150 กับฉยับ 1 รวมเงิน TOTAL 150 ผู้รับเงิน ภยักร RECEIVED BY : ขอรับเงินด้วยความขอบคุณ Elaphant Brand"
}