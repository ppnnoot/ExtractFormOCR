2025-11-22 09:30:42,774 - __main__ - INFO - üöÄ API Server logging initialized with rotation and cleanup
2025-11-22 09:30:42,774 - __main__ - INFO - üìÅ Log directory: ./logs
2025-11-22 09:30:42,774 - __main__ - INFO - üìÖ Max retention: 30 days
2025-11-22 09:30:42,855 - api_server - INFO - üöÄ API Server logging initialized with rotation and cleanup
2025-11-22 09:30:42,855 - api_server - INFO - üìÅ Log directory: ./logs
2025-11-22 09:30:42,855 - api_server - INFO - üìÖ Max retention: 30 days
2025-11-22 09:30:42,869 - api_server - INFO - Initializing components in lifespan...
2025-11-22 09:30:42,870 - template_api_manager - INFO - TemplateAPIManager initialized (API: https://ocr.rg.in.th/uapi/api/KOConfiguration-GetFormId, Cache: True)
2025-11-22 09:30:42,870 - template_api_manager - INFO - TemplateAPIManager initialized (API: https://ocr.rg.in.th/uapi/api/KOConfiguration-GetFormId, Cache: True)
2025-11-22 09:30:42,870 - api_server - INFO - Two-Step AI Pipeline initialized successfully
2025-11-22 09:30:42,870 - api_server - INFO - AI Extractor V2 initialized successfully
2025-11-22 09:30:42,870 - multi_ocr_adapter - INFO - Initialized OCR engines: ['oneocr']
2025-11-22 09:30:42,870 - api_server - INFO - Multi-OCR Manager initialized: ['oneocr']
2025-11-22 09:30:42,870 - template_api_manager - INFO - TemplateAPIManager initialized (API: https://ocr.rg.in.th/uapi/api/KOConfiguration-GetFormId, Cache: True)
2025-11-22 09:30:42,870 - document_classifier - INFO - Loading document types from Template API...
2025-11-22 09:30:42,870 - template_api_manager - INFO - Fetching all templates from API
2025-11-22 09:30:42,871 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): ocr.rg.in.th:443
2025-11-22 09:30:43,059 - urllib3.connectionpool - DEBUG - https://ocr.rg.in.th:443 "POST /uapi/api/KOConfiguration-GetFormId HTTP/1.1" 200 None
2025-11-22 09:30:43,060 - template_api_manager - DEBUG - Parsed template: HL0000055 - Statement from Hospital
2025-11-22 09:30:43,060 - template_api_manager - DEBUG - Parsed template: HL0000043 - Other medical document
2025-11-22 09:30:43,060 - template_api_manager - DEBUG - Parsed template: HL0000053 - Detail of invoice
2025-11-22 09:30:43,060 - template_api_manager - DEBUG - Parsed template: HL0000050 - Receipt-Bill
2025-11-22 09:30:43,060 - template_api_manager - DEBUG - Parsed template: HL0000051 - E-Receipt
2025-11-22 09:30:43,061 - template_api_manager - DEBUG - Parsed template: HL0000054 - Estimate Medical Expense report, GOP, guarantee email
2025-11-22 09:30:43,061 - template_api_manager - DEBUG - Parsed template: HL0000052 - Invoice
2025-11-22 09:30:43,061 - template_api_manager - INFO - Fetched 7 templates from API
2025-11-22 09:30:43,062 - document_classifier - INFO - Loaded 7 document types from API: ['B07_STATEMENT', 'HL0000043_UNKNOWN', 'B05_HOSPITAL_DETAIL', 'B01_RECEIPT', 'HL0000051_UNKNOWN', 'B06_ESTIMATE_GOP', 'B04_INVOICE']
2025-11-22 09:30:43,062 - api_server - INFO - Document Classifier initialized successfully
2025-11-22 09:30:43,062 - api_server - INFO - Authentication Manager initialized successfully
2025-11-22 09:30:43,062 - security_module - INFO - SECURITY: SYSTEM_STARTUP - {'timestamp': '2025-11-22T09:30:43.062820'}
2025-11-22 09:31:29,965 - api_server - INFO - üì§ Sending raw text to AI V2 (length: 5243) with form_id: HL0000054
2025-11-22 09:31:29,966 - ai_extraction - INFO - Step 1: Correcting spelling for HL0000054...
2025-11-22 09:31:29,966 - ai_extraction - INFO - üîç Calling AI API (attempt 1/3)
2025-11-22 09:31:29,969 - urllib3.connectionpool - DEBUG - Starting new HTTP connection (1): qdoc.ecmxpert.com:44444
2025-11-22 09:33:22,592 - urllib3.connectionpool - DEBUG - http://qdoc.ecmxpert.com:44444 "POST /v1/chat/completions HTTP/1.1" 200 9430
2025-11-22 09:33:22,595 - ai_extraction - INFO - üìù AI Response (first 200 chars): ============================================================  
‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà 1  
============================================================  
‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó ‡∏Å‡∏£‡∏∏‡∏á‡πÑ‡∏ó‡∏¢ - ‡πÅ‡∏≠‡∏Å‡∏ã‡πà‡∏≤ ‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï ‡∏à‡∏≥‡∏Å‡∏±‡∏î (‡∏°‡∏´‡∏≤‡∏ä‡∏ô) S2511192003 
2025-11-22 09:42:21,811 - security_module - INFO - SECURITY: SYSTEM_SHUTDOWN - {'timestamp': '2025-11-22T09:42:21.811100'}
2025-11-22 09:42:32,833 - __main__ - INFO - üöÄ API Server logging initialized with rotation and cleanup
2025-11-22 09:42:32,833 - __main__ - INFO - üìÅ Log directory: ./logs
2025-11-22 09:42:32,833 - __main__ - INFO - üìÖ Max retention: 30 days
2025-11-22 09:42:32,926 - api_server - INFO - üöÄ API Server logging initialized with rotation and cleanup
2025-11-22 09:42:32,926 - api_server - INFO - üìÅ Log directory: ./logs
2025-11-22 09:42:32,926 - api_server - INFO - üìÖ Max retention: 30 days
2025-11-22 09:42:32,939 - api_server - INFO - Initializing components in lifespan...
2025-11-22 09:42:32,940 - template_api_manager - INFO - TemplateAPIManager initialized (API: https://ocr.rg.in.th/uapi/api/KOConfiguration-GetFormId, Cache: True)
2025-11-22 09:42:32,940 - template_api_manager - INFO - TemplateAPIManager initialized (API: https://ocr.rg.in.th/uapi/api/KOConfiguration-GetFormId, Cache: True)
2025-11-22 09:42:32,940 - api_server - INFO - Two-Step AI Pipeline initialized successfully
2025-11-22 09:42:32,940 - api_server - INFO - AI Extractor V2 initialized successfully
2025-11-22 09:42:32,940 - multi_ocr_adapter - INFO - Initialized OCR engines: ['oneocr']
2025-11-22 09:42:32,940 - api_server - INFO - Multi-OCR Manager initialized: ['oneocr']
2025-11-22 09:42:32,940 - template_api_manager - INFO - TemplateAPIManager initialized (API: https://ocr.rg.in.th/uapi/api/KOConfiguration-GetFormId, Cache: True)
2025-11-22 09:42:32,940 - document_classifier - INFO - Loading document types from Template API...
2025-11-22 09:42:32,940 - template_api_manager - INFO - Fetching all templates from API
2025-11-22 09:42:32,941 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): ocr.rg.in.th:443
2025-11-22 09:42:33,141 - urllib3.connectionpool - DEBUG - https://ocr.rg.in.th:443 "POST /uapi/api/KOConfiguration-GetFormId HTTP/1.1" 200 None
2025-11-22 09:42:33,142 - template_api_manager - DEBUG - Parsed template: HL0000055 - Statement from Hospital
2025-11-22 09:42:33,142 - template_api_manager - DEBUG - Parsed template: HL0000043 - Other medical document
2025-11-22 09:42:33,143 - template_api_manager - DEBUG - Parsed template: HL0000053 - Detail of invoice
2025-11-22 09:42:33,143 - template_api_manager - DEBUG - Parsed template: HL0000050 - Receipt-Bill
2025-11-22 09:42:33,143 - template_api_manager - DEBUG - Parsed template: HL0000051 - E-Receipt
2025-11-22 09:42:33,143 - template_api_manager - DEBUG - Parsed template: HL0000054 - Estimate Medical Expense report, GOP, guarantee email
2025-11-22 09:42:33,143 - template_api_manager - DEBUG - Parsed template: HL0000052 - Invoice
2025-11-22 09:42:33,143 - template_api_manager - INFO - Fetched 7 templates from API
2025-11-22 09:42:33,145 - document_classifier - INFO - Loaded 7 document types from API: ['B07_STATEMENT', 'HL0000043_UNKNOWN', 'B05_HOSPITAL_DETAIL', 'B01_RECEIPT', 'HL0000051_UNKNOWN', 'B06_ESTIMATE_GOP', 'B04_INVOICE']
2025-11-22 09:42:33,145 - api_server - INFO - Document Classifier initialized successfully
2025-11-22 09:42:33,145 - api_server - INFO - Authentication Manager initialized successfully
2025-11-22 09:42:33,145 - security_module - INFO - SECURITY: SYSTEM_STARTUP - {'timestamp': '2025-11-22T09:42:33.145412'}
2025-11-22 09:42:50,344 - api_server - INFO - üì§ Sending raw text to AI V2 (length: 5243) with form_id: HL0000054
2025-11-22 09:42:50,345 - ai_extraction - INFO - Step 1: Correcting spelling for HL0000054...
2025-11-22 09:42:50,491 - ai_extraction - INFO - üîç Calling AI API (attempt 1/3)
2025-11-22 09:42:50,491 - httpcore.connection - DEBUG - connect_tcp.started host='qdoc.ecmxpert.com' port=44444 local_address=None timeout=1200 socket_options=None
2025-11-22 09:42:50,962 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x302f08260>
2025-11-22 09:42:50,964 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-11-22 09:42:50,965 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-11-22 09:42:50,965 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-11-22 09:42:50,965 - httpcore.http11 - DEBUG - send_request_body.complete
2025-11-22 09:42:50,965 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-11-22 09:44:43,021 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'date', b'Sat, 22 Nov 2025 02:42:50 GMT'), (b'server', b'uvicorn'), (b'date', b'Sat, 22 Nov 2025 02:42:51 GMT'), (b'server', b'uvicorn'), (b'keep-alive', b'timeout=15, max=100'), (b'content-type', b'application/json'), (b'content-length', b'9432'), (b'x-request-accepted-at', b'749485922069'), (b'access-control-allow-origin', b'*'), (b'x-request-id', b'749485922069')])
2025-11-22 09:44:43,024 - httpx - INFO - HTTP Request: POST http://qdoc.ecmxpert.com:44444/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-22 09:44:43,024 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-11-22 09:44:43,025 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-11-22 09:44:43,025 - httpcore.http11 - DEBUG - response_closed.started
2025-11-22 09:44:43,026 - httpcore.http11 - DEBUG - response_closed.complete
2025-11-22 09:44:43,026 - ai_extraction - INFO - üìù AI Response (first 200 chars): ============================================================  
‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà 1  
============================================================  
‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó ‡∏Å‡∏£‡∏∏‡∏á‡πÑ‡∏ó‡∏¢ - ‡πÅ‡∏≠‡∏Å‡∏ã‡πà‡∏≤ ‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï ‡∏à‡∏≥‡∏Å‡∏±‡∏î (‡∏°‡∏´‡∏≤‡∏ä‡∏ô) S2511192003 
2025-11-22 09:44:43,026 - httpcore.connection - DEBUG - close.started
2025-11-22 09:44:43,027 - httpcore.connection - DEBUG - close.complete
2025-11-22 09:54:23,913 - security_module - INFO - SECURITY: SYSTEM_SHUTDOWN - {'timestamp': '2025-11-22T09:54:23.913599'}
2025-11-22 09:54:34,090 - __main__ - INFO - üöÄ API Server logging initialized with rotation and cleanup
2025-11-22 09:54:34,090 - __main__ - INFO - üìÅ Log directory: ./logs
2025-11-22 09:54:34,090 - __main__ - INFO - üìÖ Max retention: 30 days
2025-11-22 09:54:34,172 - api_server - INFO - üöÄ API Server logging initialized with rotation and cleanup
2025-11-22 09:54:34,172 - api_server - INFO - üìÅ Log directory: ./logs
2025-11-22 09:54:34,172 - api_server - INFO - üìÖ Max retention: 30 days
2025-11-22 09:54:34,186 - api_server - INFO - Initializing components in lifespan...
2025-11-22 09:54:34,186 - template_api_manager - INFO - TemplateAPIManager initialized (API: https://ocr.rg.in.th/uapi/api/KOConfiguration-GetFormId, Cache: True)
2025-11-22 09:54:34,186 - template_api_manager - INFO - TemplateAPIManager initialized (API: https://ocr.rg.in.th/uapi/api/KOConfiguration-GetFormId, Cache: True)
2025-11-22 09:54:34,186 - api_server - INFO - Two-Step AI Pipeline initialized successfully
2025-11-22 09:54:34,186 - api_server - INFO - AI Extractor V2 initialized successfully
2025-11-22 09:54:34,186 - multi_ocr_adapter - INFO - Initialized OCR engines: ['oneocr']
2025-11-22 09:54:34,186 - api_server - INFO - Multi-OCR Manager initialized: ['oneocr']
2025-11-22 09:54:34,186 - template_api_manager - INFO - TemplateAPIManager initialized (API: https://ocr.rg.in.th/uapi/api/KOConfiguration-GetFormId, Cache: True)
2025-11-22 09:54:34,187 - document_classifier - INFO - Loading document types from Template API...
2025-11-22 09:54:34,187 - template_api_manager - INFO - Fetching all templates from API
2025-11-22 09:54:34,188 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): ocr.rg.in.th:443
2025-11-22 09:54:34,284 - urllib3.connectionpool - DEBUG - https://ocr.rg.in.th:443 "POST /uapi/api/KOConfiguration-GetFormId HTTP/1.1" 200 None
2025-11-22 09:54:34,285 - template_api_manager - DEBUG - Parsed template: HL0000055 - Statement from Hospital
2025-11-22 09:54:34,285 - template_api_manager - DEBUG - Parsed template: HL0000043 - Other medical document
2025-11-22 09:54:34,285 - template_api_manager - DEBUG - Parsed template: HL0000053 - Detail of invoice
2025-11-22 09:54:34,285 - template_api_manager - DEBUG - Parsed template: HL0000050 - Receipt-Bill
2025-11-22 09:54:34,285 - template_api_manager - DEBUG - Parsed template: HL0000051 - E-Receipt
2025-11-22 09:54:34,285 - template_api_manager - DEBUG - Parsed template: HL0000054 - Estimate Medical Expense report, GOP, guarantee email
2025-11-22 09:54:34,285 - template_api_manager - DEBUG - Parsed template: HL0000052 - Invoice
2025-11-22 09:54:34,285 - template_api_manager - INFO - Fetched 7 templates from API
2025-11-22 09:54:34,286 - document_classifier - INFO - Loaded 7 document types from API: ['B07_STATEMENT', 'HL0000043_UNKNOWN', 'B05_HOSPITAL_DETAIL', 'B01_RECEIPT', 'HL0000051_UNKNOWN', 'B06_ESTIMATE_GOP', 'B04_INVOICE']
2025-11-22 09:54:34,286 - api_server - INFO - Document Classifier initialized successfully
2025-11-22 09:54:34,286 - api_server - INFO - Authentication Manager initialized successfully
2025-11-22 09:54:34,286 - security_module - INFO - SECURITY: SYSTEM_STARTUP - {'timestamp': '2025-11-22T09:54:34.286976'}
2025-11-22 09:54:47,227 - api_server - INFO - üì§ Sending raw text to AI V2 (length: 1911) with form_id: HL0000052
2025-11-22 09:54:47,228 - ai_extraction - INFO - Step 1: Correcting spelling for HL0000052...
2025-11-22 09:54:47,336 - ai_extraction - INFO - üîç Calling AI API (attempt 1/3)
2025-11-22 09:54:47,337 - httpcore.connection - DEBUG - connect_tcp.started host='qdoc.ecmxpert.com' port=44444 local_address=None timeout=1200 socket_options=None
2025-11-22 09:54:47,422 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x175908410>
2025-11-22 09:54:47,423 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-11-22 09:54:47,423 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-11-22 09:54:47,423 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-11-22 09:54:47,423 - httpcore.http11 - DEBUG - send_request_body.complete
2025-11-22 09:54:47,423 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-11-22 09:55:44,230 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'date', b'Sat, 22 Nov 2025 02:54:47 GMT'), (b'server', b'uvicorn'), (b'date', b'Sat, 22 Nov 2025 02:54:47 GMT'), (b'server', b'uvicorn'), (b'keep-alive', b'timeout=15, max=100'), (b'content-type', b'application/json'), (b'content-length', b'4592'), (b'x-request-accepted-at', b'750201664489'), (b'access-control-allow-origin', b'*'), (b'x-request-id', b'750201664489')])
2025-11-22 09:55:44,233 - httpx - INFO - HTTP Request: POST http://qdoc.ecmxpert.com:44444/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-22 09:55:44,234 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-11-22 09:55:44,234 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-11-22 09:55:44,235 - httpcore.http11 - DEBUG - response_closed.started
2025-11-22 09:55:44,235 - httpcore.http11 - DEBUG - response_closed.complete
2025-11-22 09:55:44,235 - ai_extraction - INFO - üìù AI Response (first 200 chars): ============================================================  
‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà 1  
============================================================  
‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û BANGKOK HOSPITAL ‡πÉ‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏ú‡∏π‡πâ‡∏õ‡πà
2025-11-22 09:55:44,236 - httpcore.connection - DEBUG - close.started
2025-11-22 09:55:44,236 - httpcore.connection - DEBUG - close.complete
2025-11-22 09:55:44,236 - ai_extraction - INFO - Step 2: Extracting fields for HL0000052...
2025-11-22 09:55:44,271 - ai_extraction - INFO - üîç Calling AI API (attempt 1/3)
2025-11-22 09:55:44,272 - httpcore.connection - DEBUG - connect_tcp.started host='qdoc.ecmxpert.com' port=44444 local_address=None timeout=1200 socket_options=None
2025-11-22 09:55:44,294 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x1758473b0>
2025-11-22 09:55:44,294 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-11-22 09:55:44,294 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-11-22 09:55:44,294 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-11-22 09:55:44,294 - httpcore.http11 - DEBUG - send_request_body.complete
2025-11-22 09:55:44,294 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-11-22 09:55:58,564 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'date', b'Sat, 22 Nov 2025 02:55:44 GMT'), (b'server', b'uvicorn'), (b'date', b'Sat, 22 Nov 2025 02:55:43 GMT'), (b'server', b'uvicorn'), (b'keep-alive', b'timeout=15, max=100'), (b'content-type', b'application/json'), (b'content-length', b'1195'), (b'x-request-accepted-at', b'750259240759'), (b'access-control-allow-origin', b'*'), (b'x-request-id', b'750259240759')])
2025-11-22 09:55:58,565 - httpx - INFO - HTTP Request: POST http://qdoc.ecmxpert.com:44444/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-22 09:55:58,566 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-11-22 09:55:58,580 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-11-22 09:55:58,581 - httpcore.http11 - DEBUG - response_closed.started
2025-11-22 09:55:58,581 - httpcore.http11 - DEBUG - response_closed.complete
2025-11-22 09:55:58,582 - ai_extraction - INFO - üìù AI Response (first 200 chars): hospital_name:BANGKOK HOSPITAL CHIANG RAI\thn:55-22-002296\tan:\tinvoice_on:\tinvoice_date:17/12/2024\tcompany_name:FAY AXA\tdiscount:2134.00\tadmission_date:17/12/2024\tdischarge_date:20/12/2024\ttot
2025-11-22 09:55:58,582 - httpcore.connection - DEBUG - close.started
2025-11-22 09:55:58,582 - httpcore.connection - DEBUG - close.complete
2025-11-22 10:06:20,866 - security_module - INFO - SECURITY: SYSTEM_SHUTDOWN - {'timestamp': '2025-11-22T10:06:20.866568'}
2025-11-22 10:06:30,978 - __main__ - INFO - üöÄ API Server logging initialized with rotation and cleanup
2025-11-22 10:06:30,978 - __main__ - INFO - üìÅ Log directory: ./logs
2025-11-22 10:06:30,978 - __main__ - INFO - üìÖ Max retention: 30 days
2025-11-22 10:06:31,059 - api_server - INFO - üöÄ API Server logging initialized with rotation and cleanup
2025-11-22 10:06:31,059 - api_server - INFO - üìÅ Log directory: ./logs
2025-11-22 10:06:31,059 - api_server - INFO - üìÖ Max retention: 30 days
2025-11-22 10:06:31,074 - api_server - INFO - Initializing components in lifespan...
2025-11-22 10:06:31,074 - template_api_manager - INFO - TemplateAPIManager initialized (API: https://ocr.rg.in.th/uapi/api/KOConfiguration-GetFormId, Cache: True)
2025-11-22 10:06:31,074 - template_api_manager - INFO - TemplateAPIManager initialized (API: https://ocr.rg.in.th/uapi/api/KOConfiguration-GetFormId, Cache: True)
2025-11-22 10:06:31,074 - api_server - INFO - Two-Step AI Pipeline initialized successfully
2025-11-22 10:06:31,074 - api_server - INFO - AI Extractor V2 initialized successfully
2025-11-22 10:06:31,074 - multi_ocr_adapter - INFO - Initialized OCR engines: ['oneocr']
2025-11-22 10:06:31,074 - api_server - INFO - Multi-OCR Manager initialized: ['oneocr']
2025-11-22 10:06:31,074 - template_api_manager - INFO - TemplateAPIManager initialized (API: https://ocr.rg.in.th/uapi/api/KOConfiguration-GetFormId, Cache: True)
2025-11-22 10:06:31,074 - document_classifier - INFO - Loading document types from Template API...
2025-11-22 10:06:31,074 - template_api_manager - INFO - Fetching all templates from API
2025-11-22 10:06:31,075 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): ocr.rg.in.th:443
2025-11-22 10:06:31,175 - urllib3.connectionpool - DEBUG - https://ocr.rg.in.th:443 "POST /uapi/api/KOConfiguration-GetFormId HTTP/1.1" 200 None
2025-11-22 10:06:31,176 - template_api_manager - DEBUG - Parsed template: HL0000055 - Statement from Hospital
2025-11-22 10:06:31,176 - template_api_manager - DEBUG - Parsed template: HL0000043 - Other medical document
2025-11-22 10:06:31,176 - template_api_manager - DEBUG - Parsed template: HL0000053 - Detail of invoice
2025-11-22 10:06:31,176 - template_api_manager - DEBUG - Parsed template: HL0000050 - Receipt-Bill
2025-11-22 10:06:31,176 - template_api_manager - DEBUG - Parsed template: HL0000051 - E-Receipt
2025-11-22 10:06:31,176 - template_api_manager - DEBUG - Parsed template: HL0000054 - Estimate Medical Expense report, GOP, guarantee email
2025-11-22 10:06:31,176 - template_api_manager - DEBUG - Parsed template: HL0000052 - Invoice
2025-11-22 10:06:31,176 - template_api_manager - INFO - Fetched 7 templates from API
2025-11-22 10:06:31,178 - document_classifier - INFO - Loaded 7 document types from API: ['B07_STATEMENT', 'HL0000043_UNKNOWN', 'B05_HOSPITAL_DETAIL', 'B01_RECEIPT', 'HL0000051_UNKNOWN', 'B06_ESTIMATE_GOP', 'B04_INVOICE']
2025-11-22 10:06:31,178 - api_server - INFO - Document Classifier initialized successfully
2025-11-22 10:06:31,178 - api_server - INFO - Authentication Manager initialized successfully
2025-11-22 10:06:31,178 - security_module - INFO - SECURITY: SYSTEM_STARTUP - {'timestamp': '2025-11-22T10:06:31.178298'}
2025-11-22 10:07:20,760 - api_server - INFO - üì§ Sending raw text to AI V2 (length: 5243) with form_id: HL0000054
2025-11-22 10:07:20,761 - ai_extraction - INFO - Step 1: Correcting spelling for HL0000054...
2025-11-22 10:07:21,112 - ai_extraction - INFO - üîç Calling AI API (attempt 1/3)
2025-11-22 10:07:21,113 - httpcore.connection - DEBUG - connect_tcp.started host='qdoc.ecmxpert.com' port=44444 local_address=None timeout=1200 socket_options=None
2025-11-22 10:07:21,183 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x16415fa10>
2025-11-22 10:07:21,183 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-11-22 10:07:21,183 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-11-22 10:07:21,183 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-11-22 10:07:21,183 - httpcore.http11 - DEBUG - send_request_body.complete
2025-11-22 10:07:21,183 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-11-22 10:09:13,362 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'date', b'Sat, 22 Nov 2025 03:07:20 GMT'), (b'server', b'uvicorn'), (b'date', b'Sat, 22 Nov 2025 03:07:20 GMT'), (b'server', b'uvicorn'), (b'keep-alive', b'timeout=15, max=100'), (b'content-type', b'application/json'), (b'content-length', b'9433'), (b'x-request-accepted-at', b'750955465317'), (b'access-control-allow-origin', b'*'), (b'x-request-id', b'750955465317')])
2025-11-22 10:09:13,369 - httpx - INFO - HTTP Request: POST http://qdoc.ecmxpert.com:44444/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-22 10:09:13,369 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-11-22 10:09:13,371 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-11-22 10:09:13,371 - httpcore.http11 - DEBUG - response_closed.started
2025-11-22 10:09:13,372 - httpcore.http11 - DEBUG - response_closed.complete
2025-11-22 10:09:13,374 - ai_extraction - INFO - üìù AI Response (first 200 chars): ============================================================  
‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà 1  
============================================================  
‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó ‡∏Å‡∏£‡∏∏‡∏á‡πÑ‡∏ó‡∏¢ - ‡πÅ‡∏≠‡∏Å‡∏ã‡πà‡∏≤ ‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï ‡∏à‡∏≥‡∏Å‡∏±‡∏î (‡∏°‡∏´‡∏≤‡∏ä‡∏ô) S2511192003 
2025-11-22 10:09:13,374 - httpcore.connection - DEBUG - close.started
2025-11-22 10:09:13,374 - httpcore.connection - DEBUG - close.complete
2025-11-22 10:09:13,374 - ai_extraction - INFO - Step 2: Extracting fields for HL0000054...
2025-11-22 10:09:13,413 - ai_extraction - INFO - üîç Calling AI API (attempt 1/3)
2025-11-22 10:09:13,413 - httpcore.connection - DEBUG - connect_tcp.started host='qdoc.ecmxpert.com' port=44444 local_address=None timeout=1200 socket_options=None
2025-11-22 10:09:13,843 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x1646d3050>
2025-11-22 10:09:13,845 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-11-22 10:09:13,845 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-11-22 10:09:13,845 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-11-22 10:09:13,846 - httpcore.http11 - DEBUG - send_request_body.complete
2025-11-22 10:09:13,846 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-11-22 10:09:13,933 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 500, b'Internal Server Error', [(b'date', b'Sat, 22 Nov 2025 03:09:13 GMT'), (b'server', b'uvicorn'), (b'date', b'Sat, 22 Nov 2025 03:09:13 GMT'), (b'server', b'uvicorn'), (b'keep-alive', b'timeout=15, max=100'), (b'content-type', b'application/json'), (b'content-length', b'182'), (b'x-request-accepted-at', b'751068088116'), (b'access-control-allow-origin', b'*'), (b'x-request-id', b'751068088116')])
2025-11-22 10:09:13,934 - httpx - INFO - HTTP Request: POST http://qdoc.ecmxpert.com:44444/v1/chat/completions "HTTP/1.1 500 Internal Server Error"
2025-11-22 10:09:13,934 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-11-22 10:09:13,941 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-11-22 10:09:13,943 - httpcore.http11 - DEBUG - response_closed.started
2025-11-22 10:09:13,943 - httpcore.http11 - DEBUG - response_closed.complete
2025-11-22 10:09:13,945 - ai_extraction - WARNING - ‚ùå AI API returned status 500: {"detail":"failed to decode, try again, increasing context size or reducing parallel","error":{"message":"failed to decode, try again, increasing context size or reducing parallel"}}
2025-11-22 10:09:13,945 - ai_extraction - INFO - ‚è≥ Retrying in 1 seconds...
2025-11-22 10:09:14,951 - ai_extraction - INFO - üîç Calling AI API (attempt 2/3)
2025-11-22 10:09:14,953 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-11-22 10:09:14,954 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-11-22 10:09:14,954 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-11-22 10:09:14,955 - httpcore.http11 - DEBUG - send_request_body.complete
2025-11-22 10:09:14,955 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-11-22 10:09:34,911 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'date', b'Sat, 22 Nov 2025 03:09:14 GMT'), (b'server', b'uvicorn'), (b'date', b'Sat, 22 Nov 2025 03:09:14 GMT'), (b'server', b'uvicorn'), (b'keep-alive', b'timeout=15, max=100'), (b'content-type', b'application/json'), (b'content-length', b'1499'), (b'x-request-accepted-at', b'751069179199'), (b'access-control-allow-origin', b'*'), (b'x-request-id', b'751069179199')])
2025-11-22 10:09:34,913 - httpx - INFO - HTTP Request: POST http://qdoc.ecmxpert.com:44444/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-22 10:09:34,913 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-11-22 10:09:34,914 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-11-22 10:09:34,914 - httpcore.http11 - DEBUG - response_closed.started
2025-11-22 10:09:34,914 - httpcore.http11 - DEBUG - response_closed.complete
2025-11-22 10:09:34,915 - ai_extraction - INFO - üìù AI Response (first 200 chars): notification_no:KAL20241211827\tclaim_no:‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô:‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏Å‡∏£‡∏∏‡∏á‡πÑ‡∏ó‡∏¢-‡πÅ‡∏≠‡∏Å‡∏ã‡πà‡∏≤‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏à‡∏≥‡∏Å‡∏±‡∏î(‡∏°‡∏´‡∏≤‡∏ä‡∏ô)‡πÅ‡∏ú‡∏ô:MEH7B64\tfund_name:‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏Å‡∏£‡∏∏‡∏á‡πÑ‡∏ó‡∏¢-‡πÅ‡∏≠‡∏Å‡∏ã‡πà‡∏≤‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏à‡∏≥‡∏Å‡∏±‡∏î(‡∏°‡∏´‡∏≤‡∏ä‡∏ô)\tpatient_name:‡∏ô.‡∏™.‡∏≠‡∏±‡∏°‡∏û‡∏¥‡∏Å‡∏≤‡πÄ‡∏î‡∏µ‡∏¢‡∏ö‡∏±‡∏ß‡πÅ
2025-11-22 10:09:34,915 - httpcore.connection - DEBUG - close.started
2025-11-22 10:09:34,915 - httpcore.connection - DEBUG - close.complete
2025-11-22 10:13:36,217 - api_server - INFO - üì§ Sending raw text to AI V2 (length: 2710) with form_id: HL0000053
2025-11-22 10:13:36,218 - ai_extraction - INFO - Step 1: Correcting spelling for HL0000053...
2025-11-22 10:13:36,253 - ai_extraction - INFO - üîç Calling AI API (attempt 1/3)
2025-11-22 10:13:36,253 - httpcore.connection - DEBUG - connect_tcp.started host='qdoc.ecmxpert.com' port=44444 local_address=None timeout=1200 socket_options=None
2025-11-22 10:13:36,724 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x1646d2e40>
2025-11-22 10:13:36,726 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-11-22 10:13:36,727 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-11-22 10:13:36,727 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-11-22 10:13:36,728 - httpcore.http11 - DEBUG - send_request_body.complete
2025-11-22 10:13:36,728 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-11-22 10:13:36,799 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 500, b'Internal Server Error', [(b'date', b'Sat, 22 Nov 2025 03:13:36 GMT'), (b'server', b'uvicorn'), (b'date', b'Sat, 22 Nov 2025 03:13:35 GMT'), (b'server', b'uvicorn'), (b'keep-alive', b'timeout=15, max=100'), (b'content-type', b'application/json'), (b'content-length', b'182'), (b'x-request-accepted-at', b'751330976700'), (b'access-control-allow-origin', b'*'), (b'x-request-id', b'751330976700')])
2025-11-22 10:13:36,800 - httpx - INFO - HTTP Request: POST http://qdoc.ecmxpert.com:44444/v1/chat/completions "HTTP/1.1 500 Internal Server Error"
2025-11-22 10:13:36,801 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-11-22 10:13:36,810 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-11-22 10:13:36,811 - httpcore.http11 - DEBUG - response_closed.started
2025-11-22 10:13:36,812 - httpcore.http11 - DEBUG - response_closed.complete
2025-11-22 10:13:36,813 - ai_extraction - WARNING - ‚ùå AI API returned status 500: {"detail":"failed to decode, try again, increasing context size or reducing parallel","error":{"message":"failed to decode, try again, increasing context size or reducing parallel"}}
2025-11-22 10:13:36,813 - ai_extraction - INFO - ‚è≥ Retrying in 1 seconds...
2025-11-22 10:13:37,816 - ai_extraction - INFO - üîç Calling AI API (attempt 2/3)
2025-11-22 10:13:37,819 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-11-22 10:13:37,820 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-11-22 10:13:37,820 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-11-22 10:13:37,820 - httpcore.http11 - DEBUG - send_request_body.complete
2025-11-22 10:13:37,821 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-11-22 10:15:12,026 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'date', b'Sat, 22 Nov 2025 03:13:37 GMT'), (b'server', b'uvicorn'), (b'date', b'Sat, 22 Nov 2025 03:13:37 GMT'), (b'server', b'uvicorn'), (b'keep-alive', b'timeout=15, max=100'), (b'content-type', b'application/json'), (b'content-length', b'5043'), (b'x-request-accepted-at', b'751332086004'), (b'access-control-allow-origin', b'*'), (b'x-request-id', b'751332086004')])
2025-11-22 10:15:12,027 - httpx - INFO - HTTP Request: POST http://qdoc.ecmxpert.com:44444/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-22 10:15:12,027 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-11-22 10:15:12,028 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-11-22 10:15:12,028 - httpcore.http11 - DEBUG - response_closed.started
2025-11-22 10:15:12,029 - httpcore.http11 - DEBUG - response_closed.complete
2025-11-22 10:15:12,029 - ai_extraction - INFO - üìù AI Response (first 200 chars): ============================================================  
‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà 1  
============================================================  
‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û Print Date : 24 ‡∏™.‡∏Ñ. 2021 ‡∏à‡∏±‡∏ô‡∏ó‡∏ö‡∏∏‡∏£‡∏µ Print Time
2025-11-22 10:15:12,029 - httpcore.connection - DEBUG - close.started
2025-11-22 10:15:12,029 - httpcore.connection - DEBUG - close.complete
2025-11-22 10:15:12,030 - ai_extraction - INFO - Step 2: Extracting fields for HL0000053...
2025-11-22 10:15:12,066 - ai_extraction - INFO - üîç Calling AI API (attempt 1/3)
2025-11-22 10:15:12,066 - httpcore.connection - DEBUG - connect_tcp.started host='qdoc.ecmxpert.com' port=44444 local_address=None timeout=1200 socket_options=None
2025-11-22 10:15:12,447 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x1646f5970>
2025-11-22 10:15:12,448 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-11-22 10:15:12,449 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-11-22 10:15:12,449 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-11-22 10:15:12,450 - httpcore.http11 - DEBUG - send_request_body.complete
2025-11-22 10:15:12,450 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-11-22 10:15:12,529 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 500, b'Internal Server Error', [(b'date', b'Sat, 22 Nov 2025 03:15:11 GMT'), (b'server', b'uvicorn'), (b'date', b'Sat, 22 Nov 2025 03:15:11 GMT'), (b'server', b'uvicorn'), (b'keep-alive', b'timeout=15, max=100'), (b'content-type', b'application/json'), (b'content-length', b'182'), (b'x-request-accepted-at', b'751426711485'), (b'access-control-allow-origin', b'*'), (b'x-request-id', b'751426711485')])
2025-11-22 10:15:12,530 - httpx - INFO - HTTP Request: POST http://qdoc.ecmxpert.com:44444/v1/chat/completions "HTTP/1.1 500 Internal Server Error"
2025-11-22 10:15:12,531 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-11-22 10:15:12,545 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-11-22 10:15:12,545 - httpcore.http11 - DEBUG - response_closed.started
2025-11-22 10:15:12,546 - httpcore.http11 - DEBUG - response_closed.complete
2025-11-22 10:15:12,546 - ai_extraction - WARNING - ‚ùå AI API returned status 500: {"detail":"failed to decode, try again, increasing context size or reducing parallel","error":{"message":"failed to decode, try again, increasing context size or reducing parallel"}}
2025-11-22 10:15:12,546 - ai_extraction - INFO - ‚è≥ Retrying in 1 seconds...
2025-11-22 10:15:13,550 - ai_extraction - INFO - üîç Calling AI API (attempt 2/3)
2025-11-22 10:15:13,552 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-11-22 10:15:13,553 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-11-22 10:15:13,553 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-11-22 10:15:13,558 - httpcore.http11 - DEBUG - send_request_body.complete
2025-11-22 10:15:13,559 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-11-22 10:15:25,022 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'date', b'Sat, 22 Nov 2025 03:15:12 GMT'), (b'server', b'uvicorn'), (b'date', b'Sat, 22 Nov 2025 03:15:12 GMT'), (b'server', b'uvicorn'), (b'keep-alive', b'timeout=15, max=100'), (b'content-type', b'application/json'), (b'content-length', b'943'), (b'x-request-accepted-at', b'751427850622'), (b'access-control-allow-origin', b'*'), (b'x-request-id', b'751427850622')])
2025-11-22 10:15:25,023 - httpx - INFO - HTTP Request: POST http://qdoc.ecmxpert.com:44444/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-22 10:15:25,024 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-11-22 10:15:25,033 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-11-22 10:15:25,033 - httpcore.http11 - DEBUG - response_closed.started
2025-11-22 10:15:25,034 - httpcore.http11 - DEBUG - response_closed.complete
2025-11-22 10:15:25,035 - ai_extraction - INFO - üìù AI Response (first 200 chars): hospital_name:‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û\thn:04-04-021008\tan:AN98765\tadmission_date:23/08/2021\tpatient_name:‡∏ô‡∏≤‡∏¢ ‡∏ß‡∏£‡∏≤‡∏Å‡∏£ ‡∏ú‡∏≠‡∏ö‡πÅ‡∏Å‡πâ‡∏ß\tvn_en:104-21-010742\tamount_total:12849.00\tdiscount_total:1564.90\tnet_amount_t
2025-11-22 10:15:25,035 - httpcore.connection - DEBUG - close.started
2025-11-22 10:15:25,035 - httpcore.connection - DEBUG - close.complete
2025-11-22 10:24:07,105 - security_module - INFO - SECURITY: SYSTEM_SHUTDOWN - {'timestamp': '2025-11-22T10:24:07.105490'}
2025-11-22 10:24:19,930 - __main__ - INFO - üöÄ API Server logging initialized with rotation and cleanup
2025-11-22 10:24:19,930 - __main__ - INFO - üìÅ Log directory: ./logs
2025-11-22 10:24:19,930 - __main__ - INFO - üìÖ Max retention: 30 days
2025-11-22 10:24:20,023 - api_server - INFO - üöÄ API Server logging initialized with rotation and cleanup
2025-11-22 10:24:20,023 - api_server - INFO - üìÅ Log directory: ./logs
2025-11-22 10:24:20,023 - api_server - INFO - üìÖ Max retention: 30 days
2025-11-22 10:24:20,037 - api_server - INFO - Initializing components in lifespan...
2025-11-22 10:24:20,037 - template_api_manager - INFO - TemplateAPIManager initialized (API: https://ocr.rg.in.th/uapi/api/KOConfiguration-GetFormId, Cache: True)
2025-11-22 10:24:20,037 - template_api_manager - INFO - TemplateAPIManager initialized (API: https://ocr.rg.in.th/uapi/api/KOConfiguration-GetFormId, Cache: True)
2025-11-22 10:24:20,038 - api_server - INFO - Two-Step AI Pipeline initialized successfully
2025-11-22 10:24:20,038 - api_server - INFO - AI Extractor V2 initialized successfully
2025-11-22 10:24:20,038 - multi_ocr_adapter - INFO - Initialized OCR engines: ['oneocr']
2025-11-22 10:24:20,038 - api_server - INFO - Multi-OCR Manager initialized: ['oneocr']
2025-11-22 10:24:20,038 - template_api_manager - INFO - TemplateAPIManager initialized (API: https://ocr.rg.in.th/uapi/api/KOConfiguration-GetFormId, Cache: True)
2025-11-22 10:24:20,038 - document_classifier - INFO - Loading document types from Template API...
2025-11-22 10:24:20,038 - template_api_manager - INFO - Fetching all templates from API
2025-11-22 10:24:20,039 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): ocr.rg.in.th:443
2025-11-22 10:24:20,153 - urllib3.connectionpool - DEBUG - https://ocr.rg.in.th:443 "POST /uapi/api/KOConfiguration-GetFormId HTTP/1.1" 200 None
2025-11-22 10:24:20,154 - template_api_manager - DEBUG - Parsed template: HL0000055 - Statement from Hospital
2025-11-22 10:24:20,154 - template_api_manager - DEBUG - Parsed template: HL0000043 - Other medical document
2025-11-22 10:24:20,154 - template_api_manager - DEBUG - Parsed template: HL0000053 - Detail of invoice
2025-11-22 10:24:20,154 - template_api_manager - DEBUG - Parsed template: HL0000050 - Receipt-Bill
2025-11-22 10:24:20,154 - template_api_manager - DEBUG - Parsed template: HL0000051 - E-Receipt
2025-11-22 10:24:20,154 - template_api_manager - DEBUG - Parsed template: HL0000054 - Estimate Medical Expense report, GOP, guarantee email
2025-11-22 10:24:20,155 - template_api_manager - DEBUG - Parsed template: HL0000052 - Invoice
2025-11-22 10:24:20,155 - template_api_manager - INFO - Fetched 7 templates from API
2025-11-22 10:24:20,157 - document_classifier - INFO - Loaded 7 document types from API: ['B07_STATEMENT', 'HL0000043_UNKNOWN', 'B05_HOSPITAL_DETAIL', 'B01_RECEIPT', 'HL0000051_UNKNOWN', 'B06_ESTIMATE_GOP', 'B04_INVOICE']
2025-11-22 10:24:20,157 - api_server - INFO - Document Classifier initialized successfully
2025-11-22 10:24:20,158 - api_server - INFO - Authentication Manager initialized successfully
2025-11-22 10:24:20,158 - security_module - INFO - SECURITY: SYSTEM_STARTUP - {'timestamp': '2025-11-22T10:24:20.158328'}
2025-11-22 10:24:28,070 - api_server - INFO - üì§ Sending raw text to AI V2 (length: 1167) with form_id: HL0000055
2025-11-22 10:24:28,070 - ai_extraction - INFO - Step 1: Correcting spelling for HL0000055...
2025-11-22 10:24:28,194 - ai_extraction - INFO - üîç Calling AI API (attempt 1/3)
2025-11-22 10:24:28,195 - httpcore.connection - DEBUG - connect_tcp.started host='qdoc.ecmxpert.com' port=44444 local_address=None timeout=1200 socket_options=None
2025-11-22 10:24:28,678 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x1779382c0>
2025-11-22 10:24:28,679 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-11-22 10:24:28,680 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-11-22 10:24:28,681 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-11-22 10:24:28,682 - httpcore.http11 - DEBUG - send_request_body.complete
2025-11-22 10:24:28,682 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-11-22 10:25:03,968 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'date', b'Sat, 22 Nov 2025 03:24:28 GMT'), (b'server', b'uvicorn'), (b'date', b'Sat, 22 Nov 2025 03:24:28 GMT'), (b'server', b'uvicorn'), (b'keep-alive', b'timeout=15, max=100'), (b'content-type', b'application/json'), (b'content-length', b'2780'), (b'x-request-accepted-at', b'751983010083'), (b'access-control-allow-origin', b'*'), (b'x-request-id', b'751983010083')])
2025-11-22 10:25:03,971 - httpx - INFO - HTTP Request: POST http://qdoc.ecmxpert.com:44444/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-22 10:25:03,971 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-11-22 10:25:03,972 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-11-22 10:25:03,972 - httpcore.http11 - DEBUG - response_closed.started
2025-11-22 10:25:03,973 - httpcore.http11 - DEBUG - response_closed.complete
2025-11-22 10:25:03,973 - ai_extraction - INFO - üìù AI Response (first 200 chars): ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà 1  
============================================================  
‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏£‡∏ß‡∏°‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏â‡∏∞‡πÄ‡∏ä‡∏¥‡∏á‡πÄ‡∏ó‡∏£‡∏≤ ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà 67-04-209 RPC ‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏£‡∏ß‡∏°‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏â‡∏∞‡πÄ‡∏ä‡∏¥‡∏á‡πÄ‡∏ó‡∏£‡∏≤ RUAMPAT CHACHOENGSAO HOSPITAL 88/122-123 ‡∏´‡∏°‡∏π‡πà‡∏ó‡∏µ‡πà
2025-11-22 10:25:03,973 - httpcore.connection - DEBUG - close.started
2025-11-22 10:25:03,974 - httpcore.connection - DEBUG - close.complete
2025-11-22 10:25:03,974 - ai_extraction - INFO - Step 2: Extracting fields for HL0000055...
2025-11-22 10:25:04,008 - ai_extraction - INFO - üîç Calling AI API (attempt 1/3)
2025-11-22 10:25:04,009 - httpcore.connection - DEBUG - connect_tcp.started host='qdoc.ecmxpert.com' port=44444 local_address=None timeout=1200 socket_options=None
2025-11-22 10:25:04,062 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x1778773b0>
2025-11-22 10:25:04,062 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-11-22 10:25:04,063 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-11-22 10:25:04,063 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-11-22 10:25:04,063 - httpcore.http11 - DEBUG - send_request_body.complete
2025-11-22 10:25:04,063 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-11-22 10:25:04,125 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 500, b'Internal Server Error', [(b'date', b'Sat, 22 Nov 2025 03:25:03 GMT'), (b'server', b'uvicorn'), (b'date', b'Sat, 22 Nov 2025 03:25:03 GMT'), (b'server', b'uvicorn'), (b'keep-alive', b'timeout=15, max=100'), (b'content-type', b'application/json'), (b'content-length', b'182'), (b'x-request-accepted-at', b'752018343150'), (b'access-control-allow-origin', b'*'), (b'x-request-id', b'752018343150')])
2025-11-22 10:25:04,126 - httpx - INFO - HTTP Request: POST http://qdoc.ecmxpert.com:44444/v1/chat/completions "HTTP/1.1 500 Internal Server Error"
2025-11-22 10:25:04,127 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-11-22 10:25:04,135 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-11-22 10:25:04,135 - httpcore.http11 - DEBUG - response_closed.started
2025-11-22 10:25:04,136 - httpcore.http11 - DEBUG - response_closed.complete
2025-11-22 10:25:04,136 - ai_extraction - WARNING - ‚ùå AI API returned status 500: {"detail":"failed to decode, try again, increasing context size or reducing parallel","error":{"message":"failed to decode, try again, increasing context size or reducing parallel"}}
2025-11-22 10:25:04,137 - ai_extraction - INFO - ‚è≥ Retrying in 1 seconds...
2025-11-22 10:25:05,142 - ai_extraction - INFO - üîç Calling AI API (attempt 2/3)
2025-11-22 10:25:05,144 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-11-22 10:25:05,144 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-11-22 10:25:05,144 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-11-22 10:25:05,145 - httpcore.http11 - DEBUG - send_request_body.complete
2025-11-22 10:25:05,145 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-11-22 10:25:47,487 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'date', b'Sat, 22 Nov 2025 03:25:04 GMT'), (b'server', b'uvicorn'), (b'date', b'Sat, 22 Nov 2025 03:25:04 GMT'), (b'server', b'uvicorn'), (b'keep-alive', b'timeout=15, max=100'), (b'content-type', b'application/json'), (b'content-length', b'2774'), (b'x-request-accepted-at', b'752019445831'), (b'access-control-allow-origin', b'*'), (b'x-request-id', b'752019445831')])
2025-11-22 10:25:47,489 - httpx - INFO - HTTP Request: POST http://qdoc.ecmxpert.com:44444/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-22 10:25:47,490 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-11-22 10:25:47,490 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-11-22 10:25:47,490 - httpcore.http11 - DEBUG - response_closed.started
2025-11-22 10:25:47,491 - httpcore.http11 - DEBUG - response_closed.complete
2025-11-22 10:25:47,491 - ai_extraction - INFO - üìù AI Response (first 200 chars): hospital_name:‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏£‡∏ß‡∏°‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏â‡∏∞‡πÄ‡∏ä‡∏¥‡∏á‡πÄ‡∏ó‡∏£‡∏≤\tprovider_address:88/122-123 ‡∏´‡∏°‡∏π‡πà‡∏ó‡∏µ‡πà 13 ‡∏ñ‡∏ô‡∏ô‡∏â‡∏∞‡πÄ‡∏ä‡∏¥‡∏á‡πÄ‡∏ó‡∏£‡∏≤-‡∏û‡∏ô‡∏°‡∏™‡∏≤‡∏£‡∏Ñ‡∏≤‡∏° ‡∏ï‡∏≥‡∏ö‡∏•‡∏ö‡∏≤‡∏á‡∏ï‡∏µ‡∏ô‡πÄ‡∏õ‡πá‡∏î ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏â‡∏∞‡πÄ‡∏ä‡∏¥‡∏á‡πÄ‡∏ó‡∏£‡∏≤ ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏â‡∏∞‡πÄ‡∏ä‡∏¥‡∏á‡πÄ‡∏ó‡∏£‡∏≤ 24000\ttax_identification_number:67-04-2
2025-11-22 10:25:47,491 - httpcore.connection - DEBUG - close.started
2025-11-22 10:25:47,492 - httpcore.connection - DEBUG - close.complete
2025-11-22 10:30:34,061 - api_server - INFO - üì§ Sending raw text to AI V2 (length: 1167) with form_id: HL0000055
2025-11-22 10:30:34,063 - ai_extraction - INFO - Step 1: Correcting spelling for HL0000055...
2025-11-22 10:30:34,093 - ai_extraction - INFO - üîç Calling AI API (attempt 1/3)
2025-11-22 10:30:34,094 - httpcore.connection - DEBUG - connect_tcp.started host='qdoc.ecmxpert.com' port=44444 local_address=None timeout=1200 socket_options=None
2025-11-22 10:30:34,165 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x174fc3440>
2025-11-22 10:30:34,165 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-11-22 10:30:34,165 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-11-22 10:30:34,165 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-11-22 10:30:34,166 - httpcore.http11 - DEBUG - send_request_body.complete
2025-11-22 10:30:34,166 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-11-22 10:30:34,230 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 500, b'Internal Server Error', [(b'date', b'Sat, 22 Nov 2025 03:30:33 GMT'), (b'server', b'uvicorn'), (b'date', b'Sat, 22 Nov 2025 03:30:33 GMT'), (b'server', b'uvicorn'), (b'keep-alive', b'timeout=15, max=100'), (b'content-type', b'application/json'), (b'content-length', b'182'), (b'x-request-accepted-at', b'752348458073'), (b'access-control-allow-origin', b'*'), (b'x-request-id', b'752348458073')])
2025-11-22 10:30:34,231 - httpx - INFO - HTTP Request: POST http://qdoc.ecmxpert.com:44444/v1/chat/completions "HTTP/1.1 500 Internal Server Error"
2025-11-22 10:30:34,231 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-11-22 10:30:34,244 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-11-22 10:30:34,244 - httpcore.http11 - DEBUG - response_closed.started
2025-11-22 10:30:34,244 - httpcore.http11 - DEBUG - response_closed.complete
2025-11-22 10:30:34,245 - ai_extraction - WARNING - ‚ùå AI API returned status 500: {"detail":"failed to decode, try again, increasing context size or reducing parallel","error":{"message":"failed to decode, try again, increasing context size or reducing parallel"}}
2025-11-22 10:30:34,246 - ai_extraction - INFO - ‚è≥ Retrying in 1 seconds...
2025-11-22 10:30:35,251 - ai_extraction - INFO - üîç Calling AI API (attempt 2/3)
2025-11-22 10:30:35,253 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-11-22 10:30:35,254 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-11-22 10:30:35,254 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-11-22 10:30:35,255 - httpcore.http11 - DEBUG - send_request_body.complete
2025-11-22 10:30:35,255 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-11-22 10:31:10,557 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'date', b'Sat, 22 Nov 2025 03:30:35 GMT'), (b'server', b'uvicorn'), (b'date', b'Sat, 22 Nov 2025 03:30:35 GMT'), (b'server', b'uvicorn'), (b'keep-alive', b'timeout=15, max=100'), (b'content-type', b'application/json'), (b'content-length', b'2778'), (b'x-request-accepted-at', b'752349557488'), (b'access-control-allow-origin', b'*'), (b'x-request-id', b'752349557488')])
2025-11-22 10:31:10,558 - httpx - INFO - HTTP Request: POST http://qdoc.ecmxpert.com:44444/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-22 10:31:10,558 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-11-22 10:31:10,559 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-11-22 10:31:10,559 - httpcore.http11 - DEBUG - response_closed.started
2025-11-22 10:31:10,560 - httpcore.http11 - DEBUG - response_closed.complete
2025-11-22 10:31:10,560 - ai_extraction - INFO - üìù AI Response (first 200 chars): ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà 1  
============================================================  
‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏£‡∏ß‡∏°‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏â‡∏∞‡πÄ‡∏ä‡∏¥‡∏á‡πÄ‡∏ó‡∏£‡∏≤ ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà 67-04-209 RPC ‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏£‡∏ß‡∏°‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏â‡∏∞‡πÄ‡∏ä‡∏¥‡∏á‡πÄ‡∏ó‡∏£‡∏≤ RUAMPAT CHACHOENGSAO HOSPITAL 88/122-123 ‡∏´‡∏°‡∏π‡πà‡∏ó‡∏µ‡πà
2025-11-22 10:31:10,560 - httpcore.connection - DEBUG - close.started
2025-11-22 10:31:10,561 - httpcore.connection - DEBUG - close.complete
2025-11-22 10:31:10,561 - ai_extraction - INFO - Step 2: Extracting fields for HL0000055...
2025-11-22 10:31:10,597 - ai_extraction - INFO - üîç Calling AI API (attempt 1/3)
2025-11-22 10:31:10,597 - httpcore.connection - DEBUG - connect_tcp.started host='qdoc.ecmxpert.com' port=44444 local_address=None timeout=1200 socket_options=None
2025-11-22 10:31:11,004 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x177939640>
2025-11-22 10:31:11,005 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-11-22 10:31:11,006 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-11-22 10:31:11,006 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-11-22 10:31:11,006 - httpcore.http11 - DEBUG - send_request_body.complete
2025-11-22 10:31:11,006 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-11-22 10:31:11,068 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 500, b'Internal Server Error', [(b'date', b'Sat, 22 Nov 2025 03:31:10 GMT'), (b'server', b'uvicorn'), (b'date', b'Sat, 22 Nov 2025 03:31:11 GMT'), (b'server', b'uvicorn'), (b'keep-alive', b'timeout=15, max=100'), (b'content-type', b'application/json'), (b'content-length', b'182'), (b'x-request-accepted-at', b'752385292461'), (b'access-control-allow-origin', b'*'), (b'x-request-id', b'752385292461')])
2025-11-22 10:31:11,069 - httpx - INFO - HTTP Request: POST http://qdoc.ecmxpert.com:44444/v1/chat/completions "HTTP/1.1 500 Internal Server Error"
2025-11-22 10:31:11,070 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-11-22 10:31:11,076 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-11-22 10:31:11,077 - httpcore.http11 - DEBUG - response_closed.started
2025-11-22 10:31:11,077 - httpcore.http11 - DEBUG - response_closed.complete
2025-11-22 10:31:11,078 - ai_extraction - WARNING - ‚ùå AI API returned status 500: {"detail":"failed to decode, try again, increasing context size or reducing parallel","error":{"message":"failed to decode, try again, increasing context size or reducing parallel"}}
2025-11-22 10:31:11,078 - ai_extraction - INFO - ‚è≥ Retrying in 1 seconds...
2025-11-22 10:31:12,081 - ai_extraction - INFO - üîç Calling AI API (attempt 2/3)
2025-11-22 10:31:12,084 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-11-22 10:31:12,084 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-11-22 10:31:12,085 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-11-22 10:31:12,085 - httpcore.http11 - DEBUG - send_request_body.complete
2025-11-22 10:31:12,085 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-11-22 10:31:54,200 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'date', b'Sat, 22 Nov 2025 03:31:11 GMT'), (b'server', b'uvicorn'), (b'date', b'Sat, 22 Nov 2025 03:31:12 GMT'), (b'server', b'uvicorn'), (b'keep-alive', b'timeout=15, max=100'), (b'content-type', b'application/json'), (b'content-length', b'2772'), (b'x-request-accepted-at', b'752386384332'), (b'access-control-allow-origin', b'*'), (b'x-request-id', b'752386384332')])
2025-11-22 10:31:54,201 - httpx - INFO - HTTP Request: POST http://qdoc.ecmxpert.com:44444/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-22 10:31:54,201 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-11-22 10:31:54,202 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-11-22 10:31:54,202 - httpcore.http11 - DEBUG - response_closed.started
2025-11-22 10:31:54,202 - httpcore.http11 - DEBUG - response_closed.complete
2025-11-22 10:31:54,202 - ai_extraction - INFO - üìù AI Response (first 200 chars): hospital_name:‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏£‡∏ß‡∏°‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏â‡∏∞‡πÄ‡∏ä‡∏¥‡∏á‡πÄ‡∏ó‡∏£‡∏≤\tprovider_address:88/122-123 ‡∏´‡∏°‡∏π‡πà‡∏ó‡∏µ‡πà 13 ‡∏ñ‡∏ô‡∏ô‡∏â‡∏∞‡πÄ‡∏ä‡∏¥‡∏á‡πÄ‡∏ó‡∏£‡∏≤-‡∏û‡∏ô‡∏°‡∏™‡∏≤‡∏£‡∏Ñ‡∏≤‡∏° ‡∏ï‡∏≥‡∏ö‡∏•‡∏ö‡∏≤‡∏á‡∏ï‡∏µ‡∏ô‡πÄ‡∏õ‡πá‡∏î ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏â‡∏∞‡πÄ‡∏ä‡∏¥‡∏á‡πÄ‡∏ó‡∏£‡∏≤ ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏â‡∏∞‡πÄ‡∏ä‡∏¥‡∏á‡πÄ‡∏ó‡∏£‡∏≤ 24000\ttax_identification_number:67-04-2
2025-11-22 10:31:54,202 - httpcore.connection - DEBUG - close.started
2025-11-22 10:31:54,202 - httpcore.connection - DEBUG - close.complete
2025-11-22 10:32:56,532 - security_module - INFO - SECURITY: SYSTEM_SHUTDOWN - {'timestamp': '2025-11-22T10:32:56.532280'}
2025-11-22 10:33:06,794 - __main__ - INFO - üöÄ API Server logging initialized with rotation and cleanup
2025-11-22 10:33:06,794 - __main__ - INFO - üìÅ Log directory: ./logs
2025-11-22 10:33:06,794 - __main__ - INFO - üìÖ Max retention: 30 days
2025-11-22 10:33:06,882 - api_server - INFO - üöÄ API Server logging initialized with rotation and cleanup
2025-11-22 10:33:06,883 - api_server - INFO - üìÅ Log directory: ./logs
2025-11-22 10:33:06,883 - api_server - INFO - üìÖ Max retention: 30 days
2025-11-22 10:33:06,896 - api_server - INFO - Initializing components in lifespan...
2025-11-22 10:33:06,896 - template_api_manager - INFO - TemplateAPIManager initialized (API: https://ocr.rg.in.th/uapi/api/KOConfiguration-GetFormId, Cache: True)
2025-11-22 10:33:06,896 - template_api_manager - INFO - TemplateAPIManager initialized (API: https://ocr.rg.in.th/uapi/api/KOConfiguration-GetFormId, Cache: True)
2025-11-22 10:33:06,896 - api_server - INFO - Two-Step AI Pipeline initialized successfully
2025-11-22 10:33:06,896 - api_server - INFO - AI Extractor V2 initialized successfully
2025-11-22 10:33:06,896 - multi_ocr_adapter - INFO - Initialized OCR engines: ['oneocr']
2025-11-22 10:33:06,896 - api_server - INFO - Multi-OCR Manager initialized: ['oneocr']
2025-11-22 10:33:06,896 - template_api_manager - INFO - TemplateAPIManager initialized (API: https://ocr.rg.in.th/uapi/api/KOConfiguration-GetFormId, Cache: True)
2025-11-22 10:33:06,897 - document_classifier - INFO - Loading document types from Template API...
2025-11-22 10:33:06,897 - template_api_manager - INFO - Fetching all templates from API
2025-11-22 10:33:06,898 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): ocr.rg.in.th:443
2025-11-22 10:33:07,109 - urllib3.connectionpool - DEBUG - https://ocr.rg.in.th:443 "POST /uapi/api/KOConfiguration-GetFormId HTTP/1.1" 200 None
2025-11-22 10:33:07,110 - template_api_manager - DEBUG - Parsed template: HL0000055 - Statement from Hospital
2025-11-22 10:33:07,111 - template_api_manager - DEBUG - Parsed template: HL0000043 - Other medical document
2025-11-22 10:33:07,111 - template_api_manager - DEBUG - Parsed template: HL0000053 - Detail of invoice
2025-11-22 10:33:07,111 - template_api_manager - DEBUG - Parsed template: HL0000050 - Receipt-Bill
2025-11-22 10:33:07,111 - template_api_manager - DEBUG - Parsed template: HL0000051 - E-Receipt
2025-11-22 10:33:07,111 - template_api_manager - DEBUG - Parsed template: HL0000054 - Estimate Medical Expense report, GOP, guarantee email
2025-11-22 10:33:07,111 - template_api_manager - DEBUG - Parsed template: HL0000052 - Invoice
2025-11-22 10:33:07,111 - template_api_manager - INFO - Fetched 7 templates from API
2025-11-22 10:33:07,117 - document_classifier - INFO - Loaded 7 document types from API: ['B07_STATEMENT', 'HL0000043_UNKNOWN', 'B05_HOSPITAL_DETAIL', 'B01_RECEIPT', 'HL0000051_UNKNOWN', 'B06_ESTIMATE_GOP', 'B04_INVOICE']
2025-11-22 10:33:07,118 - api_server - INFO - Document Classifier initialized successfully
2025-11-22 10:33:07,118 - api_server - INFO - Authentication Manager initialized successfully
2025-11-22 10:33:07,118 - security_module - INFO - SECURITY: SYSTEM_STARTUP - {'timestamp': '2025-11-22T10:33:07.118628'}
2025-11-22 10:33:28,690 - api_server - INFO - üì§ Sending raw text to AI V2 (length: 560) with form_id: HL0000050
2025-11-22 10:33:28,691 - ai_extraction - INFO - Step 1: Correcting spelling for HL0000050...
2025-11-22 10:33:29,028 - ai_extraction - INFO - üîç Calling AI API (attempt 1/3)
2025-11-22 10:33:29,028 - httpcore.connection - DEBUG - connect_tcp.started host='qdoc.ecmxpert.com' port=44444 local_address=None timeout=1200 socket_options=None
2025-11-22 10:33:29,449 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x17fa39460>
2025-11-22 10:33:29,450 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-11-22 10:33:29,451 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-11-22 10:33:29,451 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-11-22 10:33:29,452 - httpcore.http11 - DEBUG - send_request_body.complete
2025-11-22 10:33:29,452 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-11-22 10:33:29,548 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 500, b'Internal Server Error', [(b'date', b'Sat, 22 Nov 2025 03:33:29 GMT'), (b'server', b'uvicorn'), (b'date', b'Sat, 22 Nov 2025 03:33:28 GMT'), (b'server', b'uvicorn'), (b'keep-alive', b'timeout=15, max=100'), (b'content-type', b'application/json'), (b'content-length', b'182'), (b'x-request-accepted-at', b'752523737529'), (b'access-control-allow-origin', b'*'), (b'x-request-id', b'752523737529')])
2025-11-22 10:33:29,550 - httpx - INFO - HTTP Request: POST http://qdoc.ecmxpert.com:44444/v1/chat/completions "HTTP/1.1 500 Internal Server Error"
2025-11-22 10:33:29,550 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-11-22 10:33:29,566 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-11-22 10:33:29,567 - httpcore.http11 - DEBUG - response_closed.started
2025-11-22 10:33:29,567 - httpcore.http11 - DEBUG - response_closed.complete
2025-11-22 10:33:29,568 - ai_extraction - WARNING - ‚ùå AI API returned status 500: {"detail":"failed to decode, try again, increasing context size or reducing parallel","error":{"message":"failed to decode, try again, increasing context size or reducing parallel"}}
2025-11-22 10:33:29,568 - ai_extraction - INFO - ‚è≥ Retrying in 1 seconds...
2025-11-22 10:33:30,573 - ai_extraction - INFO - üîç Calling AI API (attempt 2/3)
2025-11-22 10:33:30,576 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-11-22 10:33:30,577 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-11-22 10:33:30,577 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-11-22 10:33:30,577 - httpcore.http11 - DEBUG - send_request_body.complete
2025-11-22 10:33:30,577 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-11-22 10:35:17,611 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'date', b'Sat, 22 Nov 2025 03:33:30 GMT'), (b'server', b'uvicorn'), (b'date', b'Sat, 22 Nov 2025 03:33:29 GMT'), (b'server', b'uvicorn'), (b'keep-alive', b'timeout=15, max=100'), (b'content-type', b'application/json'), (b'content-length', b'1699'), (b'x-request-accepted-at', b'752619953146'), (b'access-control-allow-origin', b'*'), (b'x-request-id', b'752619953146')])
2025-11-22 10:35:17,613 - httpx - INFO - HTTP Request: POST http://qdoc.ecmxpert.com:44444/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-22 10:35:17,614 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-11-22 10:35:17,614 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-11-22 10:35:17,615 - httpcore.http11 - DEBUG - response_closed.started
2025-11-22 10:35:17,615 - httpcore.http11 - DEBUG - response_closed.complete
2025-11-22 10:35:17,615 - ai_extraction - INFO - üìù AI Response (first 200 chars): ============================================================  
‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà 1  
============================================================  
‡∏ö‡∏¥‡∏•‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î ‡∏Ñ‡∏•‡∏¥‡∏ô‡∏¥‡∏Å‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏®‡∏¥‡∏£‡∏¥‡∏ô‡∏ô‡∏ó‡πå CASH SALES - 58/8-9 ‡∏ñ.‡∏ó‡πà‡∏≤‡∏ä‡πâ‡∏≤‡∏á ‡∏≠.
2025-11-22 10:35:17,615 - httpcore.connection - DEBUG - close.started
2025-11-22 10:35:17,616 - httpcore.connection - DEBUG - close.complete
2025-11-22 10:35:17,616 - ai_extraction - INFO - Step 2: Extracting fields for HL0000050...
2025-11-22 10:35:17,652 - ai_extraction - INFO - üîç Calling AI API (attempt 1/3)
2025-11-22 10:35:17,653 - httpcore.connection - DEBUG - connect_tcp.started host='qdoc.ecmxpert.com' port=44444 local_address=None timeout=1200 socket_options=None
2025-11-22 10:35:18,027 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x17fa3b980>
2025-11-22 10:35:18,028 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-11-22 10:35:18,030 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-11-22 10:35:18,030 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-11-22 10:35:18,030 - httpcore.http11 - DEBUG - send_request_body.complete
2025-11-22 10:35:18,031 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-11-22 10:35:18,091 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 500, b'Internal Server Error', [(b'date', b'Sat, 22 Nov 2025 03:35:17 GMT'), (b'server', b'uvicorn'), (b'date', b'Sat, 22 Nov 2025 03:35:18 GMT'), (b'server', b'uvicorn'), (b'keep-alive', b'timeout=15, max=100'), (b'content-type', b'application/json'), (b'content-length', b'182'), (b'x-request-accepted-at', b'752632325310'), (b'access-control-allow-origin', b'*'), (b'x-request-id', b'752632325310')])
2025-11-22 10:35:18,092 - httpx - INFO - HTTP Request: POST http://qdoc.ecmxpert.com:44444/v1/chat/completions "HTTP/1.1 500 Internal Server Error"
2025-11-22 10:35:18,092 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-11-22 10:35:18,109 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-11-22 10:35:18,109 - httpcore.http11 - DEBUG - response_closed.started
2025-11-22 10:35:18,109 - httpcore.http11 - DEBUG - response_closed.complete
2025-11-22 10:35:18,110 - ai_extraction - WARNING - ‚ùå AI API returned status 500: {"detail":"failed to decode, try again, increasing context size or reducing parallel","error":{"message":"failed to decode, try again, increasing context size or reducing parallel"}}
2025-11-22 10:35:18,110 - ai_extraction - INFO - ‚è≥ Retrying in 1 seconds...
2025-11-22 10:35:19,115 - ai_extraction - INFO - üîç Calling AI API (attempt 2/3)
2025-11-22 10:35:19,118 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-11-22 10:35:19,123 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-11-22 10:35:19,123 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-11-22 10:35:19,123 - httpcore.http11 - DEBUG - send_request_body.complete
2025-11-22 10:35:19,123 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-11-22 10:35:25,435 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'date', b'Sat, 22 Nov 2025 03:35:18 GMT'), (b'server', b'uvicorn'), (b'date', b'Sat, 22 Nov 2025 03:35:19 GMT'), (b'server', b'uvicorn'), (b'keep-alive', b'timeout=15, max=100'), (b'content-type', b'application/json'), (b'content-length', b'985'), (b'x-request-accepted-at', b'752633406158'), (b'access-control-allow-origin', b'*'), (b'x-request-id', b'752633406158')])
2025-11-22 10:35:25,437 - httpx - INFO - HTTP Request: POST http://qdoc.ecmxpert.com:44444/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-22 10:35:25,437 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-11-22 10:35:25,451 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-11-22 10:35:25,451 - httpcore.http11 - DEBUG - response_closed.started
2025-11-22 10:35:25,452 - httpcore.http11 - DEBUG - response_closed.complete
2025-11-22 10:35:25,452 - ai_extraction - INFO - üìù AI Response (first 200 chars): hospital_name:‡∏Ñ‡∏•‡∏¥‡∏ô‡∏¥‡∏Å‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏®‡∏¥‡∏£‡∏¥‡∏ô‡∏ô‡∏ó‡πå\thn:\tvn:\treceipt_date:05/01/2565\treceipt_no:004\tpatient_name:‡∏ì‡∏ä‡∏°‡∏ô ‡∏°‡πÄ‡∏ú‡∏≤\tage:\ttreatment_date:\tpolicyno:\ttotal_amount_in_writing:150\tan:\tcashier_name:‡∏†‡∏¢‡∏±‡∏Å‡∏£\tvi
2025-11-22 10:35:25,453 - httpcore.connection - DEBUG - close.started
2025-11-22 10:35:25,453 - httpcore.connection - DEBUG - close.complete
2025-11-22 10:58:05,433 - security_module - INFO - SECURITY: SYSTEM_SHUTDOWN - {'timestamp': '2025-11-22T10:58:05.432776'}
2025-11-22 10:58:50,432 - __main__ - INFO - üöÄ API Server logging initialized with rotation and cleanup
2025-11-22 10:58:50,432 - __main__ - INFO - üìÅ Log directory: ./logs
2025-11-22 10:58:50,432 - __main__ - INFO - üìÖ Max retention: 30 days
2025-11-22 10:58:50,522 - api_server - INFO - üöÄ API Server logging initialized with rotation and cleanup
2025-11-22 10:58:50,522 - api_server - INFO - üìÅ Log directory: ./logs
2025-11-22 10:58:50,522 - api_server - INFO - üìÖ Max retention: 30 days
2025-11-22 10:58:50,535 - api_server - INFO - Initializing components in lifespan...
2025-11-22 10:58:50,535 - template_api_manager - INFO - TemplateAPIManager initialized (API: https://ocr.rg.in.th/uapi/api/KOConfiguration-GetFormId, Cache: True)
2025-11-22 10:58:50,535 - template_api_manager - INFO - TemplateAPIManager initialized (API: https://ocr.rg.in.th/uapi/api/KOConfiguration-GetFormId, Cache: True)
2025-11-22 10:58:50,535 - api_server - INFO - Two-Step AI Pipeline initialized successfully
2025-11-22 10:58:50,535 - api_server - INFO - AI Extractor V2 initialized successfully
2025-11-22 10:58:50,536 - multi_ocr_adapter - INFO - Initialized OCR engines: ['oneocr']
2025-11-22 10:58:50,536 - api_server - INFO - Multi-OCR Manager initialized: ['oneocr']
2025-11-22 10:58:50,536 - template_api_manager - INFO - TemplateAPIManager initialized (API: https://ocr.rg.in.th/uapi/api/KOConfiguration-GetFormId, Cache: True)
2025-11-22 10:58:50,536 - document_classifier - INFO - Loading document types from Template API...
2025-11-22 10:58:50,536 - template_api_manager - INFO - Fetching all templates from API
2025-11-22 10:58:50,537 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): ocr.rg.in.th:443
2025-11-22 10:58:50,746 - urllib3.connectionpool - DEBUG - https://ocr.rg.in.th:443 "POST /uapi/api/KOConfiguration-GetFormId HTTP/1.1" 200 None
2025-11-22 10:58:50,747 - template_api_manager - DEBUG - Parsed template: HL0000055 - Statement from Hospital
2025-11-22 10:58:50,747 - template_api_manager - DEBUG - Parsed template: HL0000043 - Other medical document
2025-11-22 10:58:50,747 - template_api_manager - DEBUG - Parsed template: HL0000053 - Detail of invoice
2025-11-22 10:58:50,747 - template_api_manager - DEBUG - Parsed template: HL0000050 - Receipt-Bill
2025-11-22 10:58:50,747 - template_api_manager - DEBUG - Parsed template: HL0000051 - E-Receipt
2025-11-22 10:58:50,747 - template_api_manager - DEBUG - Parsed template: HL0000054 - Estimate Medical Expense report, GOP, guarantee email
2025-11-22 10:58:50,747 - template_api_manager - DEBUG - Parsed template: HL0000052 - Invoice
2025-11-22 10:58:50,748 - template_api_manager - INFO - Fetched 7 templates from API
2025-11-22 10:58:50,749 - document_classifier - INFO - Loaded 7 document types from API: ['B07_STATEMENT', 'HL0000043_UNKNOWN', 'B05_HOSPITAL_DETAIL', 'B01_RECEIPT', 'HL0000051_UNKNOWN', 'B06_ESTIMATE_GOP', 'B04_INVOICE']
2025-11-22 10:58:50,749 - api_server - INFO - Document Classifier initialized successfully
2025-11-22 10:58:50,749 - api_server - INFO - Authentication Manager initialized successfully
2025-11-22 10:58:50,749 - security_module - INFO - SECURITY: SYSTEM_STARTUP - {'timestamp': '2025-11-22T10:58:50.749582'}
2025-11-22 10:59:07,733 - api_server - INFO - üì§ Sending raw text to AI V2 (length: 5204) with form_id: HL0000053
2025-11-22 10:59:07,733 - ai_extraction - INFO - Step 1: Correcting spelling for HL0000053...
2025-11-22 10:59:07,864 - ai_extraction - INFO - üîç Calling AI API (attempt 1/3)
2025-11-22 10:59:07,865 - httpcore.connection - DEBUG - connect_tcp.started host='qdoc.ecmxpert.com' port=44444 local_address=None timeout=1200 socket_options=None
2025-11-22 10:59:07,940 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x17d4a7b60>
2025-11-22 10:59:07,940 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-11-22 10:59:07,940 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-11-22 10:59:07,940 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-11-22 10:59:07,940 - httpcore.http11 - DEBUG - send_request_body.complete
2025-11-22 10:59:07,940 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-11-22 10:59:07,962 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 404, b'Not Found', [(b'date', b'Sat, 22 Nov 2025 03:59:06 GMT'), (b'server', b'uvicorn'), (b'content-length', b'68'), (b'content-type', b'application/json')])
2025-11-22 10:59:07,963 - httpx - INFO - HTTP Request: POST http://qdoc.ecmxpert.com:44444/v1/chat/completions "HTTP/1.1 404 Not Found"
2025-11-22 10:59:07,963 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-11-22 10:59:07,979 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-11-22 10:59:07,979 - httpcore.http11 - DEBUG - response_closed.started
2025-11-22 10:59:07,979 - httpcore.http11 - DEBUG - response_closed.complete
2025-11-22 10:59:07,980 - ai_extraction - WARNING - ‚ùå AI API returned status 404: {"error":{"message":"Model not found","code":404,"type":"NotFound"}}
2025-11-22 10:59:07,980 - ai_extraction - INFO - ‚è≥ Retrying in 1 seconds...
2025-11-22 10:59:08,985 - ai_extraction - INFO - üîç Calling AI API (attempt 2/3)
2025-11-22 10:59:08,986 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-11-22 10:59:08,987 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-11-22 10:59:08,987 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-11-22 10:59:08,987 - httpcore.http11 - DEBUG - send_request_body.complete
2025-11-22 10:59:08,987 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-11-22 10:59:09,009 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 404, b'Not Found', [(b'date', b'Sat, 22 Nov 2025 03:59:09 GMT'), (b'server', b'uvicorn'), (b'content-length', b'68'), (b'content-type', b'application/json')])
2025-11-22 10:59:09,010 - httpx - INFO - HTTP Request: POST http://qdoc.ecmxpert.com:44444/v1/chat/completions "HTTP/1.1 404 Not Found"
2025-11-22 10:59:09,010 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-11-22 10:59:09,018 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-11-22 10:59:09,018 - httpcore.http11 - DEBUG - response_closed.started
2025-11-22 10:59:09,019 - httpcore.http11 - DEBUG - response_closed.complete
2025-11-22 10:59:09,019 - ai_extraction - WARNING - ‚ùå AI API returned status 404: {"error":{"message":"Model not found","code":404,"type":"NotFound"}}
2025-11-22 10:59:09,019 - ai_extraction - INFO - ‚è≥ Retrying in 2 seconds...
2025-11-22 10:59:11,024 - ai_extraction - INFO - üîç Calling AI API (attempt 3/3)
2025-11-22 10:59:11,027 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-11-22 10:59:11,028 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-11-22 10:59:11,028 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-11-22 10:59:11,028 - httpcore.http11 - DEBUG - send_request_body.complete
2025-11-22 10:59:11,028 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-11-22 10:59:11,084 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 404, b'Not Found', [(b'date', b'Sat, 22 Nov 2025 03:59:11 GMT'), (b'server', b'uvicorn'), (b'content-length', b'68'), (b'content-type', b'application/json')])
2025-11-22 10:59:11,085 - httpx - INFO - HTTP Request: POST http://qdoc.ecmxpert.com:44444/v1/chat/completions "HTTP/1.1 404 Not Found"
2025-11-22 10:59:11,085 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-11-22 10:59:11,086 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-11-22 10:59:11,086 - httpcore.http11 - DEBUG - response_closed.started
2025-11-22 10:59:11,086 - httpcore.http11 - DEBUG - response_closed.complete
2025-11-22 10:59:11,087 - ai_extraction - WARNING - ‚ùå AI API returned status 404: {"error":{"message":"Model not found","code":404,"type":"NotFound"}}
2025-11-22 10:59:11,087 - httpcore.connection - DEBUG - close.started
2025-11-22 10:59:11,087 - httpcore.connection - DEBUG - close.complete
2025-11-22 10:59:11,087 - ai_extraction - ERROR - Step 1 correction failed
2025-11-22 10:59:19,359 - api_server - INFO - üì§ Sending raw text to AI V2 (length: 5204) with form_id: HL0000053
2025-11-22 10:59:19,359 - ai_extraction - INFO - Step 1: Correcting spelling for HL0000053...
2025-11-22 10:59:19,390 - ai_extraction - INFO - üîç Calling AI API (attempt 1/3)
2025-11-22 10:59:19,392 - httpcore.connection - DEBUG - connect_tcp.started host='qdoc.ecmxpert.com' port=44444 local_address=None timeout=1200 socket_options=None
2025-11-22 10:59:19,427 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x17d7d7230>
2025-11-22 10:59:19,428 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-11-22 10:59:19,428 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-11-22 10:59:19,428 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-11-22 10:59:19,428 - httpcore.http11 - DEBUG - send_request_body.complete
2025-11-22 10:59:19,429 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-11-22 10:59:19,454 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 404, b'Not Found', [(b'date', b'Sat, 22 Nov 2025 03:59:19 GMT'), (b'server', b'uvicorn'), (b'content-length', b'68'), (b'content-type', b'application/json')])
2025-11-22 10:59:19,454 - httpx - INFO - HTTP Request: POST http://qdoc.ecmxpert.com:44444/v1/chat/completions "HTTP/1.1 404 Not Found"
2025-11-22 10:59:19,455 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-11-22 10:59:19,467 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-11-22 10:59:19,467 - httpcore.http11 - DEBUG - response_closed.started
2025-11-22 10:59:19,467 - httpcore.http11 - DEBUG - response_closed.complete
2025-11-22 10:59:19,467 - ai_extraction - WARNING - ‚ùå AI API returned status 404: {"error":{"message":"Model not found","code":404,"type":"NotFound"}}
2025-11-22 10:59:19,468 - ai_extraction - INFO - ‚è≥ Retrying in 1 seconds...
2025-11-22 10:59:20,473 - ai_extraction - INFO - üîç Calling AI API (attempt 2/3)
2025-11-22 10:59:20,475 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-11-22 10:59:20,476 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-11-22 10:59:20,476 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-11-22 10:59:20,477 - httpcore.http11 - DEBUG - send_request_body.complete
2025-11-22 10:59:20,477 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-11-22 10:59:20,503 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 404, b'Not Found', [(b'date', b'Sat, 22 Nov 2025 03:59:20 GMT'), (b'server', b'uvicorn'), (b'content-length', b'68'), (b'content-type', b'application/json')])
2025-11-22 10:59:20,505 - httpx - INFO - HTTP Request: POST http://qdoc.ecmxpert.com:44444/v1/chat/completions "HTTP/1.1 404 Not Found"
2025-11-22 10:59:20,505 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-11-22 10:59:20,515 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-11-22 10:59:20,516 - httpcore.http11 - DEBUG - response_closed.started
2025-11-22 10:59:20,516 - httpcore.http11 - DEBUG - response_closed.complete
2025-11-22 10:59:20,517 - ai_extraction - WARNING - ‚ùå AI API returned status 404: {"error":{"message":"Model not found","code":404,"type":"NotFound"}}
2025-11-22 10:59:20,517 - ai_extraction - INFO - ‚è≥ Retrying in 2 seconds...
2025-11-22 10:59:22,521 - ai_extraction - INFO - üîç Calling AI API (attempt 3/3)
2025-11-22 10:59:22,524 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-11-22 10:59:22,525 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-11-22 10:59:22,525 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-11-22 10:59:22,525 - httpcore.http11 - DEBUG - send_request_body.complete
2025-11-22 10:59:22,526 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-11-22 10:59:22,546 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 404, b'Not Found', [(b'date', b'Sat, 22 Nov 2025 03:59:22 GMT'), (b'server', b'uvicorn'), (b'content-length', b'68'), (b'content-type', b'application/json')])
2025-11-22 10:59:22,547 - httpx - INFO - HTTP Request: POST http://qdoc.ecmxpert.com:44444/v1/chat/completions "HTTP/1.1 404 Not Found"
2025-11-22 10:59:22,548 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-11-22 10:59:22,554 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-11-22 10:59:22,554 - httpcore.http11 - DEBUG - response_closed.started
2025-11-22 10:59:22,555 - httpcore.http11 - DEBUG - response_closed.complete
2025-11-22 10:59:22,555 - ai_extraction - WARNING - ‚ùå AI API returned status 404: {"error":{"message":"Model not found","code":404,"type":"NotFound"}}
2025-11-22 10:59:22,555 - httpcore.connection - DEBUG - close.started
2025-11-22 10:59:22,556 - httpcore.connection - DEBUG - close.complete
2025-11-22 10:59:22,556 - ai_extraction - ERROR - Step 1 correction failed
2025-11-22 10:59:45,529 - api_server - INFO - üì§ Sending raw text to AI V2 (length: 560) with form_id: HL0000050
2025-11-22 10:59:45,529 - ai_extraction - INFO - Step 1: Correcting spelling for HL0000050...
2025-11-22 10:59:45,564 - ai_extraction - INFO - üîç Calling AI API (attempt 1/3)
2025-11-22 10:59:45,565 - httpcore.connection - DEBUG - connect_tcp.started host='qdoc.ecmxpert.com' port=44444 local_address=None timeout=1200 socket_options=None
2025-11-22 10:59:45,598 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x17d81c8f0>
2025-11-22 10:59:45,598 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-11-22 10:59:45,598 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-11-22 10:59:45,598 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-11-22 10:59:45,599 - httpcore.http11 - DEBUG - send_request_body.complete
2025-11-22 10:59:45,599 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-11-22 10:59:45,625 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 404, b'Not Found', [(b'date', b'Sat, 22 Nov 2025 03:59:44 GMT'), (b'server', b'uvicorn'), (b'content-length', b'68'), (b'content-type', b'application/json')])
2025-11-22 10:59:45,626 - httpx - INFO - HTTP Request: POST http://qdoc.ecmxpert.com:44444/v1/chat/completions "HTTP/1.1 404 Not Found"
2025-11-22 10:59:45,626 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-11-22 10:59:45,639 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-11-22 10:59:45,639 - httpcore.http11 - DEBUG - response_closed.started
2025-11-22 10:59:45,639 - httpcore.http11 - DEBUG - response_closed.complete
2025-11-22 10:59:45,639 - ai_extraction - WARNING - ‚ùå AI API returned status 404: {"error":{"message":"Model not found","code":404,"type":"NotFound"}}
2025-11-22 10:59:45,639 - ai_extraction - INFO - ‚è≥ Retrying in 1 seconds...
2025-11-22 10:59:46,645 - ai_extraction - INFO - üîç Calling AI API (attempt 2/3)
2025-11-22 10:59:46,645 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-11-22 10:59:46,646 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-11-22 10:59:46,646 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-11-22 10:59:46,646 - httpcore.http11 - DEBUG - send_request_body.complete
2025-11-22 10:59:46,646 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-11-22 10:59:46,671 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 404, b'Not Found', [(b'date', b'Sat, 22 Nov 2025 03:59:45 GMT'), (b'server', b'uvicorn'), (b'content-length', b'68'), (b'content-type', b'application/json')])
2025-11-22 10:59:46,672 - httpx - INFO - HTTP Request: POST http://qdoc.ecmxpert.com:44444/v1/chat/completions "HTTP/1.1 404 Not Found"
2025-11-22 10:59:46,672 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-11-22 10:59:46,686 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-11-22 10:59:46,686 - httpcore.http11 - DEBUG - response_closed.started
2025-11-22 10:59:46,686 - httpcore.http11 - DEBUG - response_closed.complete
2025-11-22 10:59:46,687 - ai_extraction - WARNING - ‚ùå AI API returned status 404: {"error":{"message":"Model not found","code":404,"type":"NotFound"}}
2025-11-22 10:59:46,687 - ai_extraction - INFO - ‚è≥ Retrying in 2 seconds...
2025-11-22 10:59:48,692 - ai_extraction - INFO - üîç Calling AI API (attempt 3/3)
2025-11-22 10:59:48,694 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-11-22 10:59:48,694 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-11-22 10:59:48,694 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-11-22 10:59:48,700 - httpcore.http11 - DEBUG - send_request_body.complete
2025-11-22 10:59:48,700 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-11-22 10:59:48,736 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 404, b'Not Found', [(b'date', b'Sat, 22 Nov 2025 03:59:47 GMT'), (b'server', b'uvicorn'), (b'content-length', b'68'), (b'content-type', b'application/json')])
2025-11-22 10:59:48,737 - httpx - INFO - HTTP Request: POST http://qdoc.ecmxpert.com:44444/v1/chat/completions "HTTP/1.1 404 Not Found"
2025-11-22 10:59:48,738 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-11-22 10:59:48,747 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-11-22 10:59:48,747 - httpcore.http11 - DEBUG - response_closed.started
2025-11-22 10:59:48,747 - httpcore.http11 - DEBUG - response_closed.complete
2025-11-22 10:59:48,748 - ai_extraction - WARNING - ‚ùå AI API returned status 404: {"error":{"message":"Model not found","code":404,"type":"NotFound"}}
2025-11-22 10:59:48,748 - httpcore.connection - DEBUG - close.started
2025-11-22 10:59:48,749 - httpcore.connection - DEBUG - close.complete
2025-11-22 10:59:48,749 - ai_extraction - ERROR - Step 1 correction failed
2025-11-22 11:25:58,292 - api_server - INFO - üì§ Sending raw text to AI V2 (length: 560) with form_id: HL0000050
2025-11-22 11:25:58,294 - ai_extraction - INFO - Step 1: Correcting spelling for HL0000050...
2025-11-22 11:25:58,334 - ai_extraction - INFO - üîç Calling AI API (attempt 1/3)
2025-11-22 11:25:58,335 - httpcore.connection - DEBUG - connect_tcp.started host='qdoc.ecmxpert.com' port=44444 local_address=None timeout=1200 socket_options=None
2025-11-22 11:25:58,749 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x17ad95100>
2025-11-22 11:25:58,749 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-11-22 11:25:58,750 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-11-22 11:25:58,750 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-11-22 11:25:58,750 - httpcore.http11 - DEBUG - send_request_body.complete
2025-11-22 11:25:58,750 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-11-22 11:25:58,778 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 404, b'Not Found', [(b'date', b'Sat, 22 Nov 2025 04:25:58 GMT'), (b'server', b'uvicorn'), (b'content-length', b'68'), (b'content-type', b'application/json')])
2025-11-22 11:25:58,779 - httpx - INFO - HTTP Request: POST http://qdoc.ecmxpert.com:44444/v1/chat/completions "HTTP/1.1 404 Not Found"
2025-11-22 11:25:58,780 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-11-22 11:25:58,804 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-11-22 11:25:58,804 - httpcore.http11 - DEBUG - response_closed.started
2025-11-22 11:25:58,804 - httpcore.http11 - DEBUG - response_closed.complete
2025-11-22 11:25:58,806 - ai_extraction - WARNING - ‚ùå AI API returned status 404: {"error":{"message":"Model not found","code":404,"type":"NotFound"}}
2025-11-22 11:25:58,806 - ai_extraction - INFO - ‚è≥ Retrying in 1 seconds...
2025-11-22 11:25:59,808 - ai_extraction - INFO - üîç Calling AI API (attempt 2/3)
2025-11-22 11:25:59,810 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-11-22 11:25:59,811 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-11-22 11:25:59,811 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-11-22 11:25:59,811 - httpcore.http11 - DEBUG - send_request_body.complete
2025-11-22 11:25:59,811 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-11-22 11:25:59,839 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 404, b'Not Found', [(b'date', b'Sat, 22 Nov 2025 04:25:59 GMT'), (b'server', b'uvicorn'), (b'content-length', b'68'), (b'content-type', b'application/json')])
2025-11-22 11:25:59,840 - httpx - INFO - HTTP Request: POST http://qdoc.ecmxpert.com:44444/v1/chat/completions "HTTP/1.1 404 Not Found"
2025-11-22 11:25:59,841 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-11-22 11:25:59,850 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-11-22 11:25:59,850 - httpcore.http11 - DEBUG - response_closed.started
2025-11-22 11:25:59,851 - httpcore.http11 - DEBUG - response_closed.complete
2025-11-22 11:25:59,851 - ai_extraction - WARNING - ‚ùå AI API returned status 404: {"error":{"message":"Model not found","code":404,"type":"NotFound"}}
2025-11-22 11:25:59,851 - ai_extraction - INFO - ‚è≥ Retrying in 2 seconds...
2025-11-22 11:26:01,862 - ai_extraction - INFO - üîç Calling AI API (attempt 3/3)
2025-11-22 11:26:01,911 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-11-22 11:26:01,915 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-11-22 11:26:01,915 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-11-22 11:26:01,916 - httpcore.http11 - DEBUG - send_request_body.complete
2025-11-22 11:26:01,916 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-11-22 11:26:01,937 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 404, b'Not Found', [(b'date', b'Sat, 22 Nov 2025 04:26:01 GMT'), (b'server', b'uvicorn'), (b'content-length', b'68'), (b'content-type', b'application/json')])
2025-11-22 11:26:01,938 - httpx - INFO - HTTP Request: POST http://qdoc.ecmxpert.com:44444/v1/chat/completions "HTTP/1.1 404 Not Found"
2025-11-22 11:26:01,939 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-11-22 11:26:01,947 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-11-22 11:26:01,947 - httpcore.http11 - DEBUG - response_closed.started
2025-11-22 11:26:01,948 - httpcore.http11 - DEBUG - response_closed.complete
2025-11-22 11:26:01,949 - ai_extraction - WARNING - ‚ùå AI API returned status 404: {"error":{"message":"Model not found","code":404,"type":"NotFound"}}
2025-11-22 11:26:01,950 - httpcore.connection - DEBUG - close.started
2025-11-22 11:26:01,950 - httpcore.connection - DEBUG - close.complete
2025-11-22 11:26:01,950 - ai_extraction - ERROR - Step 1 correction failed
